var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(g){return g.raw=g};$jscomp.createTemplateTagFirstArgWithRaw=function(g,N){g.raw=N;return g};
(function(g){function N(e){return g("#alignNameTbl"+e.attr("id").substring(8))}function W(e){g(document).mouseup(function(){if(g.data(e,"downchain")){var f=g("#offscreen_selection span");if(window.getSelection&&0<f.length){var a=window.getSelection(),l=document.createRange();l.setStart(f.get(0),0);l.setEndAfter(f.get(-1),0);a.addRange(l)}else document.selection&&(document.body.createTextRange(),document.selection.empty());g.data(e,"downchain",null)}e.data("mouseDragEdit",null)});g(document).mousemove(function(){g.data(e,
"downchain")&&(window.getSelection?(windowSelection=window.getSelection(),windowSelection.removeAllRanges()):document.selection&&document.selection.empty())});e.off();if(null==e.data("options")||"textOnly"in e.data("options")&&!e.data("options").textOnly)var d=null;if(e.data("templateData")&&e.data("templateData").charts)e.on("mouseover mousedown mouseup mousemove dblclick","td",function(f){var a=g(this).find("span");if(0!=a.length){var l=a[0].getBoundingClientRect().width,k=g(this);if(f.pageX||f.pageY)var q=
f.pageX-k.offset().left;else if(f.clientX||f.clientY)q=f.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-k.offset().left;$span=g(a[Math.floor(q/l)]);d!=$span.text()?(d=$span.text(),ca(e,$span,"mouseover",f)):(d=$span.text(),ca(e,$span,f.type,f))}});e.on("mouseover mousedown mouseup mousemove dblclick","span",function(f){ca(e,g(this),f.type,f)})}function ca(e,d,f,a){var l=d.text();ja&&Pa(d,a);if(l!=fa.gapChar){var k=d.attr("s");if(k){var q=d.closest("tr");a=q.attr("chain");var m=
q.attr("keyseqchain");a||(a=q.attr("keyseqchain")?q.attr("keyseqchain"):null);var n=q.attr("struc_id");!n&&q.attr("tpl_id")&&(n=q.attr("tpl_id"));q=e.data("templateData");if("mouseover"==f){if(null!=aa[l.toUpperCase()]){l=aa[l.toUpperCase()].triplet+" "+k+(a?" "+a:"");if(chainMapping.structures[n])for(var v=0;v<chainMapping.annotations.length;v++)if(chainMapping.annotations[v].active&&null!=chainMapping.structures[n][a][k][chainMapping.annotations[v].key]){var u=chainMapping.structures[n][a][k][chainMapping.annotations[v].key];
l+="; "+chainMapping.annotations[v].label+": "+("number"===typeof u?u.toFixed("ramachandran"==chainMapping.annotations[v].key?4:2):u)}d.attr("title",l)}a&&g("body").trigger("highlightResidue",{src:"alignment",struc_id:n,chain:a,resno:parseInt(k)})}if(!ja&&q)if(q=!("target-template"==q.type&&"target-template"==a),"mousedown"==f)g.data(e,"downspan",d),g.data(e,"downchain",a+m+n),g(".hoverResidue").removeClass("hoverResidue"),g(".selectResidue").removeClass("selectResidue");else if("mousemove"==f||"mouseup"==
f)if(g.data(e,"downchain")&&(window.getSelection?(l=window.getSelection(),l.removeAllRanges(),v=document.createRange()):document.selection&&document.selection.empty()),!a||g.data(e,"downchain")!=a+m+n)g.data(e,"downchain");else if("mousemove"!=f||null==g.data(e,"lastMouseDrag")||g.data(e,"lastMouseDrag")!=a+m+n+d.index()){g.data(e,"lastMouseDrag",a+m+n+d.index());l=e.find("tr["+(m?'keyseqchain="'+m+'"':n?'struc_id="'+n+'"':'chain="'+a+'"')+"]");var y=g.data(e,"downspan"),w=d,z=l.index(y.closest("tr")),
t=l.index(w.closest("tr"));if("mouseup"==f&&y.index()==w.index()&&z==t)d.addClass("selectResidue"),q&&g("body").trigger("centerResRange",{src:"alignment",struc_id:n,chain:m?m:a,min:k,max:k});else{if(z>t||z==t&&y.index()>w.index())k=z,w=y,y=d,z=t,t=k;if(y.index()!=w.index()||z!=t)g(".selectResidue").removeClass("selectResidue"),y.addClass("selectResidue"),w.addClass("selectResidue"),l.each(function(A){A<z||A>t||(A==z?y.nextUntil(w).addClass("selectResidue"):A==t?w.prevUntil(w).addClass("selectResidue"):
g(this).find("span").addClass("selectResidue"))});q&&"mouseup"==f&&g("body").trigger("centerResRange",{src:"alignment",struc_id:n,chain:m?m:a,min:parseInt(y.attr("s")),max:parseInt(w.attr("s"))})}e=e.find(".selectResidue");0<e.length&&(g("#offscreen_selection").html(""),e.clone().appendTo(g("#offscreen_selection")),window.getSelection?(l=window.getSelection(),v=document.createRange(),v.setStart(g("#offscreen_selection span").get(0),0),v.setEndAfter(g("#offscreen_selection span").get(-1),0),l.addRange(v)):
document.selection&&(document.body.createTextRange(),document.selection.empty()))}}}}function Pa(e,d){d.stopPropagation();d.preventDefault();if(!sa){var f=e.closest(".alignTbl"),a=e.closest("tr"),l=e.closest("tr").attr("seqno"),k=a.attr("chain");k||(k=a.attr("keyseqtype"),a.attr("keyseqchain"));f.data("templateData");if("mouseover"!=d.type)if("dblclick"==d.type)e.hasClass("shadowCursor")&&(f.data("mouseDragEdit")||("-"==e.text()?za():Aa()));else if("mousedown"==d.type){if(!e.hasClass("shadowCursor")){var q=
g(".shadowCursor").first();if(d.shiftKey&&q)if(q.closest("tr").attr("seqno")==l){g(".shadowCursor").removeClass("shadowCursor");a=f.find("tr[seqno="+l+"]").find("span");k=a.index(q);l=a.index(e);if(k<l)f.data("startEditRegion",q),f.data("endEditRegion",e);else{var m=k;k=l;l=m;f.data("startEditRegion",e);f.data("endEditRegion",q)}a.slice(k,l).each(function(){g(this).addClass("shadowCursor")});f.data("mouseDragEdit",!1)}else return;else g(".shadowCursor").removeClass("shadowCursor"),e.addClass("shadowCursor"),
f.data("mouseDragEdit",!0),f.data("startEditRegion",e),f.data("endEditRegion",e)}g(".cursor").removeClass("cursor");e.addClass("cursor")}else"mousemove"==d.type?((q=window.getSelection?window.getSelection():document.selection)&&(q.removeAllRanges?q.removeAllRanges():q.empty&&q.empty()),f.data("mouseDragEdit")&&(a=f.data("startEditRegion"),0!=a.length&&(f=0,f=d.pageX>a.offset().left?(d.pageX-a.offset().left)/a.outerWidth()|0:(d.pageX-a.offset().left-a.outerWidth())/a.outerWidth()|0,g(".shadowCursor").removeClass("shadowCursor"),
0<f?a.nextAll(":lt("+f+")").addClass("shadowCursor"):0>f&&a.prevAll().slice(0,Math.abs(f)).each(function(){g(this).addClass("shadowCursor")}),a.addClass("shadowCursor")))):"mouseup"==d.type&&(a=f.data("startEditRegion"))&&(a=f.find("tr[seqno="+l+"]").find("span"),k=a.index(q),S={seqno:l,seqidx:a.index(e)},f.data("startEditRegion",g("span.shadowCursor").first()),f.data("endEditRegion",g("span.shadowCursor").last()),f.data("mouseDragEdit",!1))}}function Ba(e,d){if(null==d||1>d.length)return!1;var f=
g("body").data("editHistory");null==f&&(f=[]);f.push(d);g("body").data("editHistory",f);f=g(".alignTbl").not(e);0<f.length&&(va(f,d,!1),g(".cursor").removeClass("cursor"));return!0}function va(e,d,f,a){e.each(function(){if(null!=g(this).data("templateData")){for(var l=g(this).data("templateData").templates,k=0;k<d.length;k++)for(var q=d[k],m=0;m<q.length;m++)for(var n=0;n<l.length;n++)if(l[n].id==q[m].template.id){f?(l[n].trg_seq=q[m].trg_seq,l[n].tpl_seq=q[m].tpl_seq):(l[n].trg_seq=q[m].template.trg_seq,
l[n].tpl_seq=q[m].template.tpl_seq);a&&(S=q[m].currentCursor,k==d.length-1&&ta(l[n]));break}g(this).is(":visible")&&da(g(this),null,{firstDraw:!1})}})}function ta(e){if(!(1>g("#seqid_"+e.id).length)){for(var d=0,f=0,a=0;a<e.trg_seq.length;a++)"-"==e.trg_seq.charAt(a)||"-"==e.tpl_seq.charAt(a)?d++:e.trg_seq.charAt(a)==e.tpl_seq.charAt(a)&&f++;g("#seqid_"+e.id).text((f/(e.trg_seq.length-d)*100).toFixed(2))}}function wa(e,d){null==e&&(38==d.keyCode?e="up":40==d.keyCode?e="down":37==d.keyCode?e="left":
39==d.keyCode&&(e="right"));if(null!=e){d&&d.preventDefault();var f=g("span.cursor").first(),a=f.closest("tr");a.closest(".alignTbl");var l=a.attr("seqno"),k=f.index(),q=k,m=a.prevAll("[seqno="+l+"]");if(0<m.length){var n=m.find("span");q+=n.length}var v=l;if("up"==e&&0<a.index()){var u=a.prev();v=u.attr("seqno");u=u.find("span:eq("+k+")")}else"down"==e&&0<a.next().length?(u=a.next(),v=u.attr("seqno"),u.find("span:eq(rowidx)"),u=a.next().find("span"),u=u.length>k?u.eq(k):u.last()):"left"==e?0==f.prev().length?
0<m.length&&(u=n.last(),q--):(u=f.prev(),q--):"right"==e&&(0<f.next().length?(u=f.next(),q++):(a=a.nextAll("[seqno="+l+"]:eq(0)"),0<a.length&&(u=a.find("span").first(),q++)));null!=u&&(f.removeClass("cursor"),u.addClass("cursor"),S={seqno:v,seqidx:q})}}function Aa(){var e=[],d=g("span.cursor").first(),f=d.closest("tr"),a=f.attr("seqno"),l=f.closest(".alignTbl");if(!d.hasClass("shadowCursor"))if(0==l.find("span.shadowCursor").length)d.addClass("shadowCursor");else return e;if(null==l.data("templateData"))return e;
var k=l.find("span.shadowCursor").last(),q=k.index(),m=k[0]==d[0],n=l.find("tr"),v=k.closest("tr"),u=g(),y=0;n.filter("[seqno="+a+"]").each(function(){y++;var R=g(this).find("span");if(g(this)[0]==v[0])return u=u.add(R.slice(0,q+1)),!1;u=u.add(R)});k=u.index(d);var w=u.text(),z=l.data("templateData").templates;f=null!=f.attr("keyseqchain");for(var t,A,H=f?null:n.filter("[seqno=1]").slice(0,y),I=d.nextAll(".shadowCursor").addBack(),F=0;F<z.length;F++)if(!(null==z[F].selected||1>z[F].selected)){if(f)t=
z[F].trg_seq,A=z[F].tpl_seq,H=n.filter("[seqno="+(z[F].selected+1)+"]").slice(0,y);else if(z[F].selected==a-1)t=z[F].tpl_seq,A=z[F].trg_seq;else continue;H.find("span").slice(0,w.length).text();for(var C="",J=!1,L=!1,D=0;D<w.length;D++)if(D<k)C+=t.charAt(C.length);else if(J)if("-"==w.charAt(D)){C+=t.charAt(C.length-1);L=!0;break}else C+=t.charAt(C.length-1);else C+="-",J=!0;L?t=C+t.substring(C.length):J&&(t=C+t.substring(C.length-1),m||(A=A.substring(0,C.length-1)+"-"+A.substring(C.length-1)));t.length>
A.length?A+=Array(t.length-A.length+1).join("-"):A.length>t.length&&(t+=Array(A.length-t.length+1).join("-"));C={template:z[F],trg_seq:z[F].trg_seq,tpl_seq:z[F].tpl_seq,currentCursor:{seqno:S.seqno,seqidx:S.seqidx}};f?(z[F].trg_seq=t,z[F].tpl_seq=A):(z[F].trg_seq=A,z[F].tpl_seq=t);ta(z[F]);e[e.length]=C}1==I.length&&g(".shadowCursor").removeClass("shadowCursor");0<e.length?(wa("right"),l.data("templateData"),m&&(l.data("startEditRegion",null),l.data("endEditRegion",null)),Ba(l,[e])&&da(l,null,{firstDraw:!1})):
Ca(d,'<strong style="color:red">The pairwise alignment already contains a gap at this position</strong>')}function Ca(e,d){sa=!0;e.removeAttr("title").popover({html:!0,content:d,placement:"top"}).popover("show");setTimeout(function(){e.popover("destroy");sa=!1},2E3)}function za(e){var d=[],f=g("span.cursor").first(),a=f.closest("tr"),l=a.attr("seqno"),k=a.closest(".alignTbl"),q=2>k.find("span.shadowCursor").length;if(e){if("-"!=f.prev().text())return;q&&f.removeClass("shadowCursor");f=f.prev();f.addClass("shadowCursor")}else if("-"!=
f.text())return;if(null==k.data("templateData"))return d;if(!f.hasClass("shadowCursor"))if(0==k.find("span.shadowCursor").length)f.addClass("shadowCursor");else return d;var m=k.find("span.shadowCursor").last(),n=m.index(),v=k.find("tr"),u=m.closest("tr"),y=g(),w=0;v.filter("[seqno="+l+"]").each(function(){w++;var R=g(this).find("span");if(g(this)[0]==u[0])return y=y.add(R.slice(0,n+1)),!1;y=y.add(R)});m=y.index(f);var z=y.text(),t=k.data("templateData").templates;a=null!=a.attr("keyseqchain");var A=
"",H=a?null:v.filter("[seqno=1]").slice(0,w);f.nextAll(".shadowCursor").addBack();for(var I=0;I<t.length;I++)if(!(null==t[I].selected||1>t[I].selected)){if(a){var F=t[I].trg_seq;var C=t[I].tpl_seq;H=v.filter("[seqno="+(t[I].selected+1)+"]").slice(0,w)}else if(t[I].selected==l-1)F=t[I].tpl_seq,C=t[I].trg_seq;else continue;A=H.find("span").slice(0,z.length).text();for(var J="",L=!1,D=0;D<z.length;D++)if(D!=m)if(D<m)J+=F.charAt(J.length);else if("-"==z.charAt(D)){if("-"!=A.charAt(D)){if(L)break;J+="-"}}else L=
!0,J+=F.charAt(J.length+1);F=q?J+F.substring(J.length+1):J+"-"+F.substring(J.length+1);F.length>C.length?C+=Array(F.length-C.length+1).join("-"):C.length>F.length&&(F+=Array(C.length-F.length+1).join("-"));A={template:t[I],trg_seq:t[I].trg_seq,tpl_seq:t[I].tpl_seq,currentCursor:{seqno:S.seqno,seqidx:S.seqidx}};a?(t[I].trg_seq=F,t[I].tpl_seq=C):(t[I].trg_seq=C,t[I].tpl_seq=F);ta(t[I]);d[d.length]=A}0<d.length?(e&&wa("left"),q&&(k.data("startEditRegion",null),k.data("endEditRegion",null)),Ba(k,[d])&&
da(k,null,{firstDraw:!1})):Ca(f,'<strong style="color:red">No valid gaps to be deleted in the selected range</strong>')}function Qa(e,d){var f=0,a=[],l=[],k=[],q="";g.each(e.templates,function(w,z){z&&(!d||z.selected)&&z.trg_seq&&(l[l.length]=z,a[a.length]="",k[k.length]=0,f=Math.max(z.trg_seq.length,f))});l.sort(function(w,z){return w.selected<z.selected?-1:w.selected>z.selected?1:0});if(0!=l.length){var m=null;e.keyseq_sequence?m=e.keyseq_sequence:(m=l[0].trg_seq,e.templates[0].up_res_num||(m=m.replace(/-/g,
"")));for(var n=0;n<f;){for(var v=0,u=0,y=0;y<l.length;y++){for(u=0;l[y].trg_seq.charAt(k[y]+u)==fa.gapChar;)u++;v=Math.max(u,v)}for(u=0;u<v;)q+=fa.gapChar,u++;q+=m.charAt(n++);for(y=0;y<l.length;y++)if(l[y].tpl_seq){for(u=0;l[y].trg_seq.charAt(k[y])==fa.gapChar;)a[y]+=l[y].tpl_seq.charAt(k[y]++),u++;for(;u<v;)a[y]+=fa.gapChar,u++;a[y]+=l[y].tpl_seq.charAt(k[y]++)}}a.target=q;a.templates=l;ta(l[0]);return a}}function Da(e,d){var f;e.templates&&(f=Qa(e,!0));if(!f)if(f=[],f.templates=["empty"],e.keyseq_sequence)f.target=
e.keyseq_sequence;else{for(var a=0;a<e.templates.length;a++)if(e.templates[a].trg_seq){f.target=e.templates[a].trg_seq.replace(/-/g,"");break}a=e.templates[a].trg_seq.length-f.target.length;1==e.templates.length&&0<a&&g("#alignmentWarning_"+d.attr("id").substring(8)).html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Note: </strong> '+a+" gaps were removed from your target sequence</div>")}return f}function da(e,d,f){$alignNameTbl=
N(e);e.removeData("clustalColours");var a=e.data().templateData;a||(a=g("#alignTbl").data().templateData);if(a){d||(d=Da(a,e));for(var l=0,k=0;k<d.length;k++){var q=d[k].match(/[a-zA-Z]/g);q&&(l+=q.length)}l={cols:60,fastDraw:!1,textOnly:15E3<l,showResiduePosition:!0};e.data("options")?f=g.extend(e.data("options"),f):(f||(f={}),!f.cols&&e.attr("cols_cookie")&&g.cookie(e.attr("cols_cookie"))&&(f.cols=g.cookie(e.attr("cols_cookie"))),f=g.extend(l,f));0==f.cols&&(f.cols=50);f.cols=parseInt(f.cols);k=
e.attr("id").substring(8);l=f.fastDraw;f.textOnly?(g("#alignTbl"+k+"_features").remove(),e.off()):l&&(g("#alignTbl"+k+"_features").html(""),(q=Ea["timer"+k])&&clearTimeout(q),f.fastDraw=!1,q=setTimeout(function(){da(e,d)},10),Ea["timer"+k]=q);e.data("options",f);for(k=document.getElementById(e.attr("id"));k.hasChildNodes();)k.removeChild(k.lastChild);for(k=document.getElementById($alignNameTbl.attr("id"));k&&k.hasChildNodes();)k.removeChild(k.lastChild);var m=a.target_name?a.target_name:"model-template"==
a.type?a.struc_id:a.type.split("-")[0];m=m.charAt(0).toUpperCase()+m.substring(1);var n="SEQRES"==m.toUpperCase();var v=void 0!==a.templates?a.templates[0].modelAtomSeqs?a.templates[0].modelAtomSeqs[0].seq.length:d.target.length:d.target.length;q=k="";if(a.nowrap){k='<tr><td style="padding-top:0px;">';q='<tr><td style="padding-top:0px;border-right:none">&nbsp;</td></tr>';for(var u=d.templates[0].trg_offset;u<v+d.templates[0].trg_offset;u++)0<u&&(0<u&&0==u%10?(k+='<span style="position:relative;color:#A2A2A2;">&nbsp;',
k+='<span style="position:absolute;left:0px;top:8px;font-size:.7em;">|</span>',k+='<span style="position:absolute;left:0px;top:0px;font-size:.8em;">'+u+"</span>",k+="</span>"):k+="<span>&nbsp;</span>")}k+="</td></tr>";u={};for(var y={},w=0;w<v;w+=f.cols){for(var z=1,t=0;t<a.keyseq_chain_name.length;t++){var A=[],H=void 0;H=void 0!==a.templates?a.templates[0].modelAtomSeqs?a.templates[0].modelAtomSeqs[t].seq:d.target:d.target;var I=a.keyseq_chain_name[t];q+='<tr seqno="'+z+'" '+Fa(a.keyseq_description)+
"><td"+(0<w&&0==t||a.charts?' style="position:relative; padding-top:'+(ha+ba+10)+'px"':"")+">"+(0<ha?'<div style="position:absolute; right:4px; top:'+(ha+ba)/2+'px ">QMEAN</div>':"")+m+(1<a.keyseq_chain_name.length?":"+I:"")+"</td></tr>";var F=d.templates[0].trg_offset?d.templates[0].trg_offset:1;void 0!==a.templates&&a.templates[0].modelAtomSeqs&&(F=a.templates[0].modelAtomSeqs[t].trg_offset);k+='<tr seqno="'+z+'" keyseqtype="'+a.type+'"';a.struc_id&&(k+=' struc_id="'+a.struc_id+'" keyseqchain="'+
I+'"');k+="><td"+(0<w&&0==t||a.charts?' style="padding-top:'+(ha+ba+10)+'px"':"")+">";f.fastDraw?k+=Ga(H.substring(w,w+f.cols)):f.textOnly?k+="<span>"+H.substring(w,w+f.cols)+"</span>":(k+=Ha(H.substring(w,w+f.cols),{alIndex:w,pos:Ia(H.substring(0,w)),offset:F,annotation:a.keyseq_annotation?a.keyseq_annotation[I]:null,seqres:n,up_res_num:a.templates&&a.templates[t]&&a.templates[t].up_res_num?a.templates[t].up_res_num:null,resmap:A,keyseq:!0}),u[I]||(u[I]=[]),u[I]=u[I].concat(A));k+="</td></tr>";z+=
1}for(t=0;t<d.length;t++)A="model-template"!=a.type&&d.templates[t].struc_id?[]:null,H=a.templates[0].modelAtomSeqs?a.templates[0].modelAtomSeqs[t].seq:d.target,d.templates[t].tpl_seq&&(q+='<tr seqno="'+z+'" '+(null!=d.templates[t].id?'tpl_id="'+d.templates[t].id+'"':"")+' chain="'+d.templates[t].chain+'"'+Fa(d.templates[t].description)+'><td nowrap align="left" >'+d.templates[t].qname+"</td></tr>",I=d.templates[t].offset?d.templates[t].offset+1:1,k+='<tr seqno="'+z+'" '+(null!=d.templates[t].id?
'tpl_id="'+d.templates[t].id+'"':"")+("model-template"!=a.type&&d.templates[t].struc_id?' struc_id="'+d.templates[t].struc_id+'"':"")+' qname="'+d.templates[t].qname+'" chain="'+d.templates[t].chain+'"><td nowrap align="left">',f.fastDraw?k+=Ga(d[t].substring(w,w+f.cols)):f.textOnly?k+="<span>"+d[t].substring(w,w+f.cols)+"</span>":(k+=Ha(d[t].substring(w,w+f.cols),{alIndex:w,pos:Ia(d[t].substring(0,w)),offset:I,seqres:n,annotation:d.templates[t].annotation,targetSeq:H.substring(w,w+f.cols),pdb_res_num:a.templates[t].pdb_res_num?
a.templates[t].pdb_res_num.slice(w,w+f.cols):null,resmap:A,keyseq:!1}),A&&(y[d.templates[t].struc_id]||(y[d.templates[t].struc_id]={}),y[d.templates[t].struc_id][d.templates[t].chain]||(y[d.templates[t].struc_id][d.templates[t].chain]=[]),y[d.templates[t].struc_id][d.templates[t].chain]=y[d.templates[t].struc_id][d.templates[t].chain].concat(A))),k+="</td></tr>"),z+=1}if(-1==chainMapping.alignments.indexOf(e.attr("id"))){if(a.modelLabel)if("model-template"==a.type)for(kchn in u)chainMapping.chainMeta[a.struc_id]||
(chainMapping.chainMeta[a.struc_id]={}),chainMapping.chainMeta[a.struc_id][kchn]||(chainMapping.chainMeta[a.struc_id][kchn]={display:a.modelLabel});else for(m=0;m<a.templates.length;m++)chainMapping.chainMeta[a.templates[m].struc_id]||(chainMapping.chainMeta[a.templates[m].struc_id]={}),chainMapping.chainMeta[a.templates[m].struc_id][a.templates[m].chain]||(chainMapping.chainMeta[a.templates[m].struc_id][a.templates[m].chain]={display:a.modelLabel});chainMapping.alignments.push(e.attr("id"));for(kchn in u)if("model-template"==
a.type)for(a.md5&&(chainMapping.targets[a.md5]||(chainMapping.targets[a.md5]={}),chainMapping.targets[a.md5][a.struc_id]||(chainMapping.targets[a.md5][a.struc_id]=[])),chainMapping.structures[a.struc_id]||(chainMapping.structures[a.struc_id]={}),chainMapping.structures[a.struc_id][kchn]||(chainMapping.structures[a.struc_id][kchn]=[]),m=0;m<u[kchn].length;m++)u[kchn][m]&&(n=!1,v=null,chainMapping.structures[a.struc_id][kchn][u[kchn][m][1]]?(n=!0,v=chainMapping.structures[a.struc_id][kchn][u[kchn][m][1]]):
v={trgno:u[kchn][m][1],trgname:u[kchn][m][0],chn:kchn,resno:u[kchn][m][1],resname:u[kchn][m][0]},3==u[kchn][m].length&&("qmean"in u[kchn][m][2].anno&&(v.qm=u[kchn][m][2].anno.qmean),"qmeanbrane"in u[kchn][m][2].anno&&(v.qmb=u[kchn][m][2].anno.qmeanbrane),"consistency"in u[kchn][m][2].anno&&(v.c=u[kchn][m][2].anno.consistency)),n||(a.md5&&(chainMapping.targets[a.md5][a.struc_id][u[kchn][m][1]]||(chainMapping.targets[a.md5][a.struc_id][u[kchn][m][1]]=[]),chainMapping.targets[a.md5][a.struc_id][u[kchn][m][1]].push(v)),
chainMapping.structures[a.struc_id][kchn][u[kchn][m][1]]=v));else for(m=0;m<u[kchn].length;m++)for(var C in y){chainMapping.targets[a.md5]||(chainMapping.targets[a.md5]={});chainMapping.targets[a.md5][C]||(chainMapping.targets[a.md5][C]=[]);chainMapping.structures[C]||(chainMapping.structures[C]={});for(var J in y[C])chainMapping.structures[C][J]||(chainMapping.structures[C][J]=[]),y[C][J][m]&&(n=!1,v=null,chainMapping.structures[C][J][y[C][J][m][1]]?(n=!0,v=chainMapping.structures[C][J][y[C][J][m][1]]):
(v={chn:J,resno:y[C][J][m][1],resname:y[C][J][m][0]},u[kchn][m]&&(v.trgno=u[kchn][m][1],v.trgname=u[kchn][m][0])),3==y[C][J][m].length&&("qmean"in y[C][J][m][2].anno&&(v.qm=y[C][J][m][2].anno.qmean),"qmeanbrane"in y[C][J][m][2].anno&&(v.qmb=y[C][J][m][2].anno.qmean),"consistency"in y[C][J][m][2].anno&&(v.c=y[C][J][m][2].anno.consistency)),n||(u[kchn][m]&&(chainMapping.targets[a.md5][C][u[kchn][m][1]]||(chainMapping.targets[a.md5][C][u[kchn][m][1]]=[]),chainMapping.targets[a.md5][C][u[kchn][m][1]].push(v)),
chainMapping.structures[C][J][y[C][J][m][1]]=v))}}(C=g.cookie("secStruct"))&&"none"==C||e.addClass("ss");$alignNameTbl.last().append(q);e.last().append(k);var L;!a.nowrap&&f.showResiduePosition&&e.find("tr").each(function(D,R){L=0<D&&1==R.getAttribute("seqno")?"padding-top:"+(ha+ba+10)+"px;":"";var T=g(this).find("span[s]").last().attr("s");T&&g(this).append('<td style="padding-left:8px; font-size:.8em; text-align:right; '+L+'">'+T+"</td>")});l||(chainMapping.defaultColourScheme?(g("#"+chainMapping.defaultColourScheme+
"Button").prop("checked",!0),ka(chainMapping.defaultColourScheme,e)):ka(g.cookie("colourScheme"),e),d=null,f.firstDraw||la(e))}}function Ia(e){return(e=e.match(/[^-]/g))?e.length:0}function Fa(e){return e?' title="'+e+'" ':""}function Ga(e){for(var d="",f=0;f<e.length;f++)d+="<span>"+e.charAt(f)+"</span>";return d}function Ha(e,d){if(!e)return"";for(var f=d.pos,a=d.alIndex,l=d.seqres,k=null!=d.targetSeq,q=[],m=null,n=0;n<e.length;n++){var v=e.charAt(n);if(v==fa.gapChar)q.push('<span nm="true">-</span>'),
d.resmap&&d.resmap.push(null);else{if(d.pdb_res_num){var u=d.pdb_res_num[n]-d.offset;var y=d.pdb_res_num[n-1],w=d.pdb_res_num[n],z=d.pdb_res_num[n+1];var t=d.pdb_res_num[n];y&&y!=w-1&&y!=w?(0<n&&"-"==e.charAt(n-1)&&(q[n-1]=q[n-1].substring(0,q[n-1].length-9)+' class="insert_r">-</span>'),q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+' class="insert_l">'+v+"</span>")):z&&w!=z-1&&z!=w?(q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=
v?' nm="true"':"")+' class="insert_r">'+v+"</span>"),n<e.length-2&&"-"==e.charAt(n+1)&&(q.push('<span nm="true" class="insert_l">-</span>'),n++)):q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>")}else d.up_res_num?(u=a+n,y=d.up_res_num[a+n-1],w=d.up_res_num[a+n],z=d.up_res_num[a+n+1],null==w&&(w=m+=1),null==z&&(y=w-1,z=w+1),t=w,q.push("<span "+(0<a+n&&y!=w-1?'class="insert_l"':"")+(a+n<a+e.length-1&&w!=z-1?'class="insert_r"':"")+(' s="'+
w+'" r="'+v.toUpperCase()+'"')+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>"),m=w):l?(u=a+n,t=a+n+d.offset,q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>")):(u=f,t=f+d.offset,q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>"),f++);if(d.resmap){v=[v.toUpperCase(),t];if(d.annotation){v.push({anno:{}});for(var A in d.annotation)d.annotation[A]&&d.annotation[A][u]&&
(v[v.length-1].anno[A]=d.annotation[A][u]),d.keyseq&&"qmean"==A&&null==d.annotation.qmean[u]&&(q[q.length-1]='<span nores="true" '+q[q.length-1].substring(6))}d.resmap.push(v)}}}return q.join("")}function ma(e,d,f){e[f][d]?e[f][d]++:e[f][d]=1}function Ra(e){for(var d,f,a=[],l=0;l<e[0].length;l++){a[l]={};for(var k=d=0;k<e.length;k++)f=e[k].charAt(l).toUpperCase(),f==fa.gapChar?d++:(ma(a,f,l),"Q"!=f&&"E"!=f||ma(a,"QE",l),"E"==f||"D"==f?ma(a,"ED",l):-1<"/[WLVIMAFCYHP]/".indexOf(f)?ma(a,"WLVIMAFCYHP",
l):"K"==f||"R"==f?ma(a,"KR",l):("T"==f||"S"==f)&&ma(a,"TS",l));a[l].gapCount=d;f={};for(var q in a[l])f[q+"_nogap"]=(a[l][q]/e.length).toFixed(2),a[l][q]=(a[l][q]/(e.length-d)).toFixed(2);for(q in f)a[l][q]=f[q]}return a}function ka(e,d){var f=d.find("span");if(0!=f.length){g.each(f,function(B,G){G.style.backgroundColor&&(G.style.backgroundColor="")});d.data("features")||d.removeData("features");null==e&&(e="rainbow");if(d.data("features")){var a={};for(k in d.data("features"))a.$jscomp$loop$prop$struc_id$15$67=
k,a.$jscomp$loop$prop$seqno$16$65=0,a.$jscomp$loop$prop$$rows$66=d.find("tr[struc_id]"),a.$jscomp$loop$prop$$rows$66.filter("[struc_id="+a.$jscomp$loop$prop$struc_id$15$67+"]").each(function(B){return function(G,K){if(B.$jscomp$loop$prop$seqno$16$65>parseInt(K.getAttribute("seqno")))return!1;B.$jscomp$loop$prop$seqno$16$65=parseInt(K.getAttribute("seqno"));var E=K.getAttribute("chain");E||(E=K.getAttribute("keyseqchain"));for(var O=B.$jscomp$loop$prop$$rows$66.filter("tr[seqno="+B.$jscomp$loop$prop$seqno$16$65+
"]").find(" span[s]"),P=0;P<d.data("features")[B.$jscomp$loop$prop$struc_id$15$67].length;P++){var M=d.data("features")[B.$jscomp$loop$prop$struc_id$15$67][P],U=M.rgb.split(",").map(Number);if(M.frmChn!=M.toChn)console.error("THIS IS AN ERROR "+M);else if(-1!=M.frmChn.indexOf(E))for(var Q=M.resStart;Q<M.resEnd+1;Q++)chainMapping.structures[B.$jscomp$loop$prop$struc_id$15$67][E][Q]&&(chainMapping.structures[B.$jscomp$loop$prop$struc_id$15$67][E][Q].rgb=U)}O.each(function(Sa,pa){var qa=parseInt(pa.getAttribute("s"));
chainMapping.structures[B.$jscomp$loop$prop$struc_id$15$67][E][qa]&&(pa.style.backgroundColor="rgba("+chainMapping.structures[B.$jscomp$loop$prop$struc_id$15$67][E][qa].rgb+",.6)")})}}(a)),a={$jscomp$loop$prop$seqno$16$65:a.$jscomp$loop$prop$seqno$16$65,$jscomp$loop$prop$$rows$66:a.$jscomp$loop$prop$$rows$66,$jscomp$loop$prop$struc_id$15$67:a.$jscomp$loop$prop$struc_id$15$67}}else if("chain"==e||"uniqueChain"==e||"template"==e){var l=null;if("undefined"!=typeof globalTemplateData){if(l=globalTemplateData,
!globalTemplateData.chainColoursAssigned){for(a=0;a<globalTemplateData.length;a++){var k=globalTemplateData[a];k.chainColours={chain:[],unique:[],template:V[a%V.length]};for(var q=k.chain_name?"chain_name":"chain",m=0;m<k[q].length;m++){k.chainColours.unique[1<k[q][m].length?k[q][m].join(""):k[q][m]]=V[ia];ia++;ia%=12;for(var n=0;n<k[q][m].length;n++)k.chainColours.chain[k[q][m][n]]=V[Y],Y++,Y%=V.length}}globalTemplateData.chainColoursAssigned=!0}}else l=d.data("templateData").templates,g(".alignTbl").each(function(){var B=
g(this).data("templateData");if(B&&B.templates&&!B.chainColoursAssigned){for(var G=0;G<B.templates.length;G++)if(B.templates[G].chainColours={chain:[],unique:[]},"model-template"==B.type)for(var K=0;K<B.keyseq_chain_name.length;K++)B.templates[G].chainColours.chain[B.keyseq_chain_name[K]]=V[Y],B.templates[G].chainColours.unique[B.keyseq_chain_name[K]]=V[ia],Y++,Y%=V.length;else B.templates[G].chainColours.chain[B.templates[G].chain]=V[Y],B.templates[G].chainColours.unique[B.templates[G].chain]=V[ia],
Y++,Y%=V.length;ia++;ia%=V.length;B.chainColoursAssigned=!0}});l?g.each(d.find("tr[struc_id]"),function(B,G){var K=G.getAttribute("struc_id"),E=G.getAttribute("keyseqchain");E||(E=G.getAttribute("chain"));if(!E)return!1;for(var O=g(this).find("span[s]"),P=null,M={},U=0;U<l.length;M={$jscomp$loop$prop$rgb$22$69:M.$jscomp$loop$prop$rgb$22$69},U++)if(l[U].struc_id==K){P=l[U];M.$jscomp$loop$prop$rgb$22$69=void 0;if("chain"==e)M.$jscomp$loop$prop$rgb$22$69=P.chainColours.chain[E];else if("template"==e)M.$jscomp$loop$prop$rgb$22$69=
P.chainColours.template;else for(chns in P.chainColours.unique)if(-1<chns.indexOf(E)){M.$jscomp$loop$prop$rgb$22$69=P.chainColours.unique[chns];break}M.$jscomp$loop$prop$rgb$22$69&&O.each(function(Q){return function(Sa,pa){pa.style.backgroundColor="rgb("+Q.$jscomp$loop$prop$rgb$22$69+",.6)";if(K){var qa=parseInt(pa.getAttribute("s"));chainMapping.structures[K]&&chainMapping.structures[K][E]&&chainMapping.structures[K][E][qa]&&(chainMapping.structures[K][E][qa].rgb=Q.$jscomp$loop$prop$rgb$22$69)}}}(M))}}):
d.find("span").each(function(B,G){G.style.backgroundColor="rgba("+V[g(".alignTbl").index(d)%V.length]+",.6)"})}else if("rainbow"==e){var v=!1,u=0,y=d.find("tr");y.each(function(B,G){var K=G.getAttribute("struc_id"),E=G.getAttribute("chain");E||(E=G.getAttribute("keyseqchain"));0==B&&(v="model-template"==G.getAttribute("keyseqtype"));var O=parseInt(G.getAttribute("seqno"));if(O<=u)return!1;u=O;if(!v||null!=G.getAttribute("keyseqtype"))for($span=y.filter("[seqno="+u+"]").find("span[s]:not([nores])"),
O=0;O<$span.length;O++){var P=$span[O].getAttribute("s");if(null!=P){var M=O/$span.length*(1.5*Math.PI-Math.PI/2)+Math.PI/2;M=[Math.round(127.5*(Math.sin(M+Math.PI)+1)),Math.round(255*Math.sin(M-Math.PI/2)),Math.round(127.5*(Math.sin(M)+1))];$span[O].style.backgroundColor="rgba("+M+",.6)";K&&chainMapping.structures[K]&&chainMapping.structures[K][E]&&(P=parseInt(P),chainMapping.structures[K][E][P]&&(chainMapping.structures[K][E][P].rgb=M))}}})}else if("qmean_local"==e){var w="qm";"undefined"!==typeof qmeanbraneActive&&
qmeanbraneActive&&(w="qmb");d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),G=g(this).attr("chain");G||(G=g(this).attr("keyseqchain"));var K=g(this).find("span[s]"),E=!0,O=!1;for(chn in chainMapping.structures[B]){for(res in chainMapping.structures[B][chn])if(chainMapping.structures[B][chn][res])if(chainMapping.structures[B][chn][res][w]){if(1<chainMapping.structures[B][chn][res][w]){E=!1;break}}else chainMapping.structures[B][chn][res].bfactor&&(O=!0);if(!E)break}if(O)return na(d,
"bfactor_range",g(this)),!0;g.each(K,function(P,M){var U=parseInt(M.getAttribute("s"));if(!chainMapping.structures[B][G][U])return!0;var Q=chainMapping.structures[B][G][U][w];if(null==Q)return!0;E||(Q/=100);Q=qmeanLocalColour(Q,.6);M.style.backgroundColor=Q;Q=Q.substring(5).split(",").slice(0,3).map(Number);chainMapping.structures[B][G][U].rgb=Q})})}else if("confClass"==e)d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),G=g(this).attr("chain");G||(G=g(this).attr("keyseqchain"));
var K=g(this).find("span[s]"),E=!0,O=!1;for(chn in chainMapping.structures[B]){for(res in chainMapping.structures[B][chn])if(chainMapping.structures[B][chn][res])if(chainMapping.structures[B][chn][res].qm){if(1<chainMapping.structures[B][chn][res].qm){E=!1;break}}else chainMapping.structures[B][chn][res].bfactor&&(O=!0);if(!E)break}if(O)return na(d,"bfactor_range",g(this)),!0;g.each(K,function(P,M){var U=parseInt(M.getAttribute("s"));if(!chainMapping.structures[B][G][U])return!0;var Q=chainMapping.structures[B][G][U].qm;
if(!Q)return!0;E&&(Q*=100);rgb=90<Q?[0,83,214]:70<Q?[101,203,243]:50<Q?[255,219,19]:[255,125,69];M.style.backgroundColor="rgba("+rgb+",.6)";chainMapping.structures[B][G][U].rgb=rgb})});else if(-1<e.indexOf("consistency")){var z=0,t=1;"consistency"!=e&&(z=999,t=-99,d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),G=g(this).attr("chain");G||(G=g(this).attr("keyseqchain"));if(!G)return!0;for(var K=0;K<chainMapping.structures[B][G].length;K++)chainMapping.structures[B][G][K]&&chainMapping.structures[B][G][K].c&&
(z=Math.min(z,chainMapping.structures[B][G][K].c),t=Math.max(t,chainMapping.structures[B][G][K].c))}));d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),G=g(this).attr("chain");G||(G=g(this).attr("keyseqchain"));if(!G)return!0;for(var K=g(this).find("span[s]").toArray(),E=0;E<K.length;E++){var O=[127,195,45],P=parseInt(K[E].getAttribute("s")),M=chainMapping.structures[B][G][P].c;M&&(t!=z&&(M=(parseFloat(M)-z)/(t-z),.5>M?(O[0]=Math.round(255*(1-M)),O[1]=Math.round(160*M),O[2]=Math.round(90*
M)):(O[0]=127,O[1]=Math.round(20+175*M),O[2]=45)),K[E].style.backgroundColor="rgba("+O+",0.6)",B&&(chainMapping.structures[B][G][P].rgb=O))}})}else if("clustal"==e){var A=d.data("clustalColours");A||(a=Da(d.data("templateData"),d),A=Ra(a.concat(a.target)),d.data("clustalColours",A));var H,I=0,F;d.find("tr").each(function(){if(parseInt(g(this).attr("seqno"))<I)return!1;var B=g(this).attr("struc_id"),G=g(this).attr("chain");G||(G=g(this).attr("keyseqchain"));I=parseInt(g(this).attr("seqno"));var K=
d.find("tr[seqno="+I+"] span");g.each(K,function(E,O){if(null!=A[E]&&O.hasAttribute("r")&&(H=O.getAttribute("r"),"P"==H?F=Ta:"G"==H?F=Ua:"H"!=H&&"Y"!=H||!(.6<=A[E].WLVIMAFCYHP||.5<A[E].P)?"D"==H&&(.5<=A[E].N||.5<=A[E].ED&&.5<=!A[E].QE)?F=Ja:"E"==H&&(.5<=A[E].ED||.5<=A[E].QE)?F=Ja:"C"==H&&.85<=A[E].C?F=Va:"N"==H&&(.5<=A[E].N||.85<=A[E].D)?F=ua:"Q"==H&&(.6<=A[E].KR||.5<=A[E].QE)?F=ua:"S"==H&&(.5<=A[E].TS||.8<=A[E].WLVIMAFCYHP)?F=ua:"T"==H&&(.5<=A[E].TS||.6<=A[E].WLVIMAFCYHP)?F=ua:"R"!=H&&"K"!=H||!(.6<=
A[E].KR||.85<=A[E].Q)?-1<"/[WLVIMAF]/".indexOf(H)&&(.5<=A[E].P||.6<=A[E].WLVIMAFCYHP)?F=Ka:"A"!=H&&"C"!=H||!(.5<=A[E].P||.6<=A[E].WLVIMAFCYHP||.85<=A[E].S)||(F=Ka):F=Wa:F=Xa,F&&(O.style.backgroundColor="rgb("+F+",.5)",B&&chainMapping.structures[B]&&chainMapping.structures[B][G]))){var P=parseInt(O.getAttribute("s"));chainMapping.structures[B][G][P]&&(chainMapping.structures[B][G][P].rgb=F)}})})}else if("secstruc"==e){a=g.cookie("secStruct");null==a&&(a="dssp");k=d.data("templateData");q=d.find("tr");
var C;if(k.keyseq_annotation)for(m=0;m<k.keyseq_chain_name.length;m++){var J=k.struc_id;n=k.keyseq_chain_name[m];if(k.keyseq_annotation[n]&&k.keyseq_annotation[n][a])for(var L=xa(k.keyseq_annotation[n],a).replace(/[GI]/g,"H").replace(/B/g,"E"),D=0;D<L.length;D++)chainMapping.structures[J][n][D+1]&&(chainMapping.structures[J][n][D+1].ss=L[D]);else if(chainMapping.structures[J])for(L=0;L<chainMapping.structures[J][n].length;L++)chainMapping.structures[J][n][L]&&(chainMapping.structures[J][n][L].ss=
null)}else if(k.templates)for(m=0;m<k.templates.length;m++)if(n=k.templates[m],n.annotation&&n.annotation[a])for(L=xa(n.annotation,a).replace(/[GI]/g,"H").replace(/B/g,"E"),D=0;D<L.length;D++)chainMapping.structures[n.struc_id][n.chain][D+1]&&(chainMapping.structures[n.struc_id][n.chain][D+1].ss=L[D]);else if(n.struc_id&&"none"!=a){L=!1;for(D=0;!L&&D<chainMapping.structures[n.struc_id][n.chain].length;D++)chainMapping.structures[n.struc_id][n.chain][D]&&chainMapping.structures[n.struc_id][n.chain][D].ss&&
(L=!0);L||fetchSecStruc(n.struc_id)}m=0;n={};for(L=0;L<q.length;n={$jscomp$loop$prop$annot$48$71:n.$jscomp$loop$prop$annot$48$71,$jscomp$loop$prop$chn$47$72:n.$jscomp$loop$prop$chn$47$72},L++){D=q.eq(L);if(parseInt(D.attr("seqno"))<m)break;m=parseInt(D.attr("seqno"));n.$jscomp$loop$prop$chn$47$72=D.attr("chain");n.$jscomp$loop$prop$chn$47$72||(n.$jscomp$loop$prop$chn$47$72=D.attr("keyseqchain"));J=D.attr("struc_id");n.$jscomp$loop$prop$annot$48$71=null;if(!J){if("model-template"==k.type)for(D=0;D<
k.templates.length;D++)if(k.templates[D].chain==n.$jscomp$loop$prop$chn$47$72){k.templates[D].annotation&&k.templates[D].annotation[a]&&(n.$jscomp$loop$prop$annot$48$71=xa(k.templates[D].annotation,a),n.$jscomp$loop$prop$annot$48$71=n.$jscomp$loop$prop$annot$48$71.replace(/[GI]/g,"H").replace(/B/g,"E"));break}if(!n.$jscomp$loop$prop$annot$48$71)continue}$row=q.filter('[seqno="'+m+'"]');D=$row.find("span[s]").toArray();g.each(D,function(B){return function(G,K){var E=null;C=parseInt(K.getAttribute("s"));
B.$jscomp$loop$prop$annot$48$71?"E"==B.$jscomp$loop$prop$annot$48$71[C-1]?E=[51,204,51]:"H"==B.$jscomp$loop$prop$annot$48$71[C-1]&&(E=[153,153,230]):chainMapping.structures[J][B.$jscomp$loop$prop$chn$47$72][C]&&("E"==chainMapping.structures[J][B.$jscomp$loop$prop$chn$47$72][C].ss?E=[51,204,51]:"H"==chainMapping.structures[J][B.$jscomp$loop$prop$chn$47$72][C].ss&&(E=[153,153,230]),chainMapping.structures[J][B.$jscomp$loop$prop$chn$47$72][C].rgb=E);K.style.backgroundColor="rgba("+E+",.6)"}}(n))}}else if(-1<
["hydrophobic","size","charged","cysteine"].indexOf(e)||aa[e])d.find("tr").each(function(){var B=g(this).attr("struc_id"),G=g(this).attr("chain");G||(G=g(this).attr("keyseqchain"));var K=g(this).find("span");g.each(K,function(E,O){if((res=O.getAttribute("r"))&&aa[res]){var P=Ya(e,res);if(!P)return!0;O.style.backgroundColor="rgba("+P+",.6)";if(B&&chainMapping.structures[B]&&chainMapping.structures[B][G]){var M=parseInt(O.getAttribute("s"));chainMapping.structures[B][G][M]&&(chainMapping.structures[B][G][M].rgb=
P)}}})});else if("soa"==e)na(d,"soa");else if(-1<e.indexOf("bfactor"))na(d,e);else if("entropy"==e)na(d,"entropy");else if("indels"==e&&"model-template"==d.data("templateData").type&&d.data("templateData").templates[0].tpl_seq){a=d.data("templateData");var R=a.struc_id;k=99999999;q=0;m=[];n=[];for(L=0;L<a.templates.length;L++)if(a.templates[L].struc_id==R)for(trgOffset=a.templates[L].trg_offset?a.templates[L].trg_offset-1:0,a.templates[L].residue_from?(k=Math.min(k,a.templates[L].residue_from),q=
Math.max(q,a.templates[L].residue_to)):(k=0,q=99999999999),D=0;D<a.templates[L].trg_seq.length;D++)"-"!=a.templates[L].trg_seq.charAt(D)&&(n[D]="X"),"-"!=a.templates[L].tpl_seq.charAt(D)&&(m[D]="X");L=null;D=1+trgOffset;for(var T=[],Z=[],X=0;X<a.templates[0].trg_seq.length;X++){if(!m[X])for(var ea=0;-1==T.indexOf(D)&&ea<a.keyseq_chain_name.length;ea++)D>=k&&D<=q&&T.push(D);if(n[X])L=D,D++;else if(null!=L)for(ea=0;-1==Z.indexOf(D)&&ea<a.keyseq_chain_name.length;ea++)D>=k&&D<=q&&Z.push(D),D-1>=k&&D<=
q&&Z.push(D-1)}k={};for(q=0;q<a.keyseq_chain_name.length;k={$jscomp$loop$prop$chain$59$74:k.$jscomp$loop$prop$chain$59$74},q++)k.$jscomp$loop$prop$chain$59$74=a.keyseq_chain_name[q],m=d.find("tr[keyseqchain="+k.$jscomp$loop$prop$chain$59$74+"]"),g.each(m.find("span[s]:not([nores])"),function(B){return function(G,K){var E=parseInt(K.getAttribute("s"));if(-1<T.indexOf(E))rgb=[80,214,80];else if(-1<Z.indexOf(E))rgb=[100,100,255];else return!0;K.style.backgroundColor="rgba("+rgb+",.6)";chainMapping.structures[R][B.$jscomp$loop$prop$chain$59$74][E].rgb=
rgb}}(k))}g.cookie("targetMismatch")?"fade"==g.cookie("targetMismatch")?f.filter("[nm]").addClass("targetMismatch"):"enhance"==g.cookie("targetMismatch")&&(f.not("[nm]").addClass("targetMismatch"),f.not("[s]").addClass("targetMismatch")):f.filter("[nm]").addClass("targetMismatch");ja&&(S&&d.find("tr[seqno="+S.seqno+"]").find("span").eq(S.seqidx).addClass("cursor"),d.data("startEditRegion")&&d.data("endEditRegion")&&(f=d.data("startEditRegion"),a=d.data("endEditRegion"),q=f.closest("tr"),k=q.attr("seqno"),
q=q.siblings("[seqno="+k+"]").addBack().find("span"),k=d.find("tr[seqno="+k+"]").find("span"),k=k.slice(q.index(f),q.index(a)+1).addClass("shadowCursor"),d.data("startEditRegion",k.first()),d.data("endEditRegion",k.last())))}}function Ya(e,d){if("hydrophobic"==e){var f=aa[d][e];return null==f?void 0:[Math.round(255*f),0,255-Math.round(255*f)]}if("size"==e)return f=aa[d][e],null==f?void 0:[Math.round(255*f),255-Math.round(255*f),0];if("charged"==e){if(-1<aa.positive.indexOf(d))return[100,100,255];
if(-1<aa.negative.indexOf(d))return[255,100,100]}else return"cysteine"==e?"C"==d?[202,168,14]:null:-1<aa[e].indexOf(d)?[20,80,250]:null}function na(e,d,f){var a=!1,l=null,k=null,q="bfactor_range"==d;q&&(d="bfactor");(f?f:e.find("tr[struc_id]")).each(function(){l=g(this).attr("struc_id");k=g(this).attr("qname");var m=g(this).attr("chain");m||(m=g(this).attr("keyseqchain"));if(!m)return!0;var n=g(this).find("span[s]");g.each(n,function(v,u){var y=parseInt(u.getAttribute("s"));if(!(chainMapping.structures[l]&&
chainMapping.structures[l][m]&&chainMapping.structures[l][m][y]&&d in chainMapping.structures[l][m][y]))return!0;a=!0;var w=chainMapping.structures[l][m][y][d],z=[0,200,0];"entropy"==d?z=1.9>w?[Math.floor(w/1.9*256),Math.floor(w/1.9*256),255]:[255,256-Math.floor((w-1.9)/1.9*256),256-Math.floor((w-1.9)/1.9*256)]:"soa"==d?(w=Math.max(0,Math.min(1,.01*w)),z=[Math.floor(255*(1-w)),0,255-Math.floor(255*(1-w))]):"bfactor"==d&&(q?(w=chainMapping.annotations.map(function(t){return t.key}).indexOf("bfactor_range"),
chainMapping.annotations[w].rangeColours[l]&&chainMapping.annotations[w].rangeColours[l][m]&&(z=chainMapping.annotations[w].rangeColours[l][m][y])):z=10>=w?[0,0,255]:10<w&&15>=w?[115,115,255]:15<w&&20>=w?[170,170,255]:20<w&&25>=w?[215,215,255]:25<w&&30>=w?[255,215,215]:30<w&&35>=w?[255,170,170]:35<w&&40>=w?[255,115,115]:[255,0,0]);u.style.backgroundColor="rgba("+z+",.6)";chainMapping.structures[l][m][y].rgb=z})});a||(!k||"soa"!=d&&"entropy"!=d||"undefined"===typeof SCORE_URL?"bfactor"==d&&fetchBFactors(l,
"bfactor")&&na(e,d+(q?"_range":"")):g.getJSON(SCORE_URL.replace("xxxx.0",k.match(/\w{4}\.\d+/)[0])+d,function(m){for(chn in m)for(var n=0;n<m[chn].values.length;n++)null!=m[chn].values[n]&&chainMapping.structures[l]&&chainMapping.structures[l][chn]&&chainMapping.structures[l][chn][n+m[chn].offset+1]&&(chainMapping.structures[l][chn][n+m[chn].offset+1][d]=m[chn].values[n]);ka(d,e);ra()}))}function ra(e){e&&e.singleResidue||("function"===typeof colourRama&&colourRama(),"function"===typeof colourModelBars&&
colourModelBars());"undefined"!==typeof currentWin&&(0<g("#pv:visible",currentWin.document).length&&Za(),0<g("#ngl:visible",currentWin.document).length&&(e&&e.singleResidue?$a(e.singleResidue):ab(e)))}function $a(e){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf("singleres")&&(NGL.ColormakerRegistry.removeScheme(schemeId),ngl_stage.eachRepresentation(function(f){if(f.repr.colorScheme==schemeId)for(schemeId2 in NGL.ColormakerRegistry.userSchemes)if(schemeId2.endsWith(f.name)){f.setColor(schemeId2);
break}}));if(e){var d=e.struc_id;getNGLComponentByName(d)&&ngl_stage.eachRepresentation(function(f){if(f.name==d&&chainMapping.structures[d]){var a=NGL.ColormakerRegistry.addScheme(function(l){for(chn in chainMapping.structures[d])" "==chn&&g("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(k){return chainMapping.structures[d][k.chainname]&&chainMapping.structures[d][k.chainname][k.resno]&&chainMapping.structures[d][k.chainname][k.resno].rgb?ngl_picked_atom&&
k.structure.name==ngl_picked_atom.structure.name&&k.index==ngl_picked_atom.index?16711680:chainMapping.structures[d][k.chainname][k.resno].rgb[0]<<16|chainMapping.structures[d][k.chainname][k.resno].rgb[1]<<8|chainMapping.structures[d][k.chainname][k.resno].rgb[2]:16777215}},"singleres");f.setColor(a)}})}}function ab(e){var d=[];ngl_stage.eachRepresentation(function(l){d.push(l.name)});e=e&&e.strucId?e.strucId:null;var f={},a;for(a in ngl_stage.compList){if(void 0!==ngl_stage.compList[a].structure&&
(f.$jscomp$loop$prop$strucId$76=ngl_stage.compList[a].name,!e||f.$jscomp$loop$prop$strucId$76==e)){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(f.$jscomp$loop$prop$strucId$76)&&-1==schemeId.indexOf("membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);ngl_stage.eachRepresentation(function(l){return function(k){if((k.name==l.$jscomp$loop$prop$strucId$76||k.name.endsWith(".highlight")||"drug.surroundings"==k.name)&&chainMapping.structures[l.$jscomp$loop$prop$strucId$76]){var q=
NGL.ColormakerRegistry.addScheme(function(m){for(chn in chainMapping.structures[l.$jscomp$loop$prop$strucId$76])" "==chn&&g("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(n){return chainMapping.structures[l.$jscomp$loop$prop$strucId$76][n.chainname]&&chainMapping.structures[l.$jscomp$loop$prop$strucId$76][n.chainname][n.resno]&&chainMapping.structures[l.$jscomp$loop$prop$strucId$76][n.chainname][n.resno].rgb?chainMapping.structures[l.$jscomp$loop$prop$strucId$76][n.chainname][n.resno].rgb[0]<<
16|chainMapping.structures[l.$jscomp$loop$prop$strucId$76][n.chainname][n.resno].rgb[1]<<8|chainMapping.structures[l.$jscomp$loop$prop$strucId$76][n.chainname][n.resno].rgb[2]:16777215}},l.$jscomp$loop$prop$strucId$76);k.setColor(q)}}}(f))}f={$jscomp$loop$prop$strucId$76:f.$jscomp$loop$prop$strucId$76}}}function Za(){var e=[];pv_viewer.forEach(function(a){e.push(a.name())});if(0!=e.length){var d={},f;for(f in chainMapping.structures)d.$jscomp$loop$prop$strucId$78=f,-1<e.indexOf(d.$jscomp$loop$prop$strucId$78)&&
pv_viewer.get(d.$jscomp$loop$prop$strucId$78)&&pv_viewer.get(d.$jscomp$loop$prop$strucId$78).colorBy(new pv.color.ColorOp(function(a){return function(l,k,q){l=l.residue();chainMapping.structures[a.$jscomp$loop$prop$strucId$78][l.chain().name()]&&chainMapping.structures[a.$jscomp$loop$prop$strucId$78][l.chain().name()][l.num()]&&chainMapping.structures[a.$jscomp$loop$prop$strucId$78][l.chain().name()][l.num()].rgb?(k[q]=chainMapping.structures[a.$jscomp$loop$prop$strucId$78][l.chain().name()][l.num()].rgb[0]/
255,k[q+1]=chainMapping.structures[a.$jscomp$loop$prop$strucId$78][l.chain().name()][l.num()].rgb[1]/255,k[q+2]=chainMapping.structures[a.$jscomp$loop$prop$strucId$78][l.chain().name()][l.num()].rgb[2]/255):(k[q]=.9,k[q+1]=.9,k[q+2]=.9);k[q+3]=1}}(d))),d={$jscomp$loop$prop$strucId$78:d.$jscomp$loop$prop$strucId$78};pv_viewer.requestRedraw()}}function la(e){var d=g.cookie("secStruct");null==d&&(d="dssp");var f=e.attr("id")+"_features";g("#"+f).html("");if(0==g("#"+f).length||d&&"none"==d)e.removeClass("ss"),
N(e).removeClass("ss");else{e.addClass("ss");N(e).addClass("ss");var a=e.position().top,l=e.find("td").first().width(),k=e.find("span")[0],q=k.getBoundingClientRect().width;k=k.getBoundingClientRect().height;var m=e.position().left;if(!(1>l)){p=Raphael(f,l,e.height());g("#"+f).css("top",e.position().top);var n=e.data("templateData");if(n){e=e.find("tr:visible");if(n.keyseq_annotation)for(f=0;f<n.keyseq_chain_name.length;f++){var v=n.keyseq_chain_name[f];if(n.keyseq_annotation[v]){var u=n.templates[0].trg_offset?
n.templates[0].trg_offset:1;n.keyseq_annotation[v][d]&&La(p,Ma(n.keyseq_annotation[v],d,u),e.filter('[keyseqchain="'+v+'"]'),e.filter('[keyseqchain="'+v+'"]').find("span[s]").toArray(),a,m,l,q,k);n.charts&&function(A,H,I){setTimeout(function(){bb(A,n.keyseq_annotation[H],d,u,I,a,l,q,5E3>n.pageResidueCount)},0)}(p,v,e.filter('[keyseqchain="'+v+'"]'))}}f=0;for(v=1;v<e.length;v++){var y=e.eq(v);if(parseInt(y.attr("seqno"))<f)break;f=parseInt(y.attr("seqno"));if(!y.attr("keyseqtype")){var w=y.attr("tpl_id");
y=y.attr("chain");$row=w?e.filter('[tpl_id="'+w+'"]'):e.filter('[chain="'+y+'"]');for(var z=$row.find("span[s]").toArray(),t=0;t<n.templates.length;t++)(w?n.templates[t].id==w:n.templates[t].chain==y)&&n.templates[t].annotation&&n.templates[t].annotation[d]&&La(p,Ma(n.templates[t].annotation,d),$row,z,a,m,l,q,k)}}}}}}function xa(e,d){var f=e[d];"string"==typeof f&&(e[d+"_string"]=f.replace(/[GI]/g,"H").replace(/B/g,"E"));return e[d+"_string"]}function Ma(e,d,f){f||(f=1);var a=e[d];if("string"==typeof a){e[d+
"_string"]=e[d];a=e[d].replace(/[GI]/g,"H").replace(/B/g,"E");for(var l=null,k=0;k<a.length;k++)if("H"==a[k]||"E"==a[k])res_index=k+f,null==l?l=[[res_index,res_index,a[k]]]:l[l.length-1][1]==res_index-1&&l[l.length-1][2]==a[k]?l[l.length-1][1]=res_index:l.push([res_index,res_index,a[k]]);e[d]=l}return e[d]}function bb(e,d,f,a,l,k,q,m,n){var v=null!=d.qmean;a||(a=1);var u=e.set(),y=e.set(),w=e.set();l.each(function(z,t){span=g(t).find("span").toArray();if(0!=span.length){var A=t.getAttribute("struc_id"),
H=t.getAttribute("chain");H||(H=t.getAttribute("keyseqchain"));var I=ha-ba,F=g(t).position().top-k+g(span[0]).position().top-ba,C=F,J=t.getBoundingClientRect().left,L=span[span.length-1].getBoundingClientRect().right-J;if(v){e.path("M0,"+C+"L"+q+","+C+"L"+q+","+(C-I)+"L0,"+(C-I)).attr({"stroke-width":.4,stroke:"#888"});for(var D=3;10>D;D++){var R=C-1/.7*I*(D/10-.3);var T=e.path("M0,"+R+"L"+q+","+R);5==D?T.attr({"stroke-width":.7,opacity:.8,stroke:"#888","stroke-dasharray":"-"}):u.push(T)}}T="";var Z;
for(D=0;D<span.length;D++)if(C=span[D],C.hasAttribute("s")){R=parseInt(C.getAttribute("s"));var X=R-a;T=d[f+"_string"]&&d[f+"_string"][X]?T+d[f+"_string"][X]:T+"-";x=C.getBoundingClientRect().left-J;C=F;C-=2;if(v)if(X=Math.max(.3,chainMapping.structures[A][H][R].qm),R=C-1/.7*(I-2)*(X-.3),n){var ea="245,80,0";.5<X&&(z=Math.round(490*(1-X)),b=Math.round(255*X),ea=z+",80,"+b);s=e.path("M"+x+","+C+"L"+x+","+R+"L"+(x+m)+","+R+"L"+(x+m)+","+C);s.attr({fill:"rgba("+ea+",.6)",stroke:"#333"})}else Z+="M"+
x+" "+C,Z+="L"+x+" "+R,Z+="L"+(x+m)+" "+R,Z+="L"+(x+m)+" "+C}else T+="-";txt=e.text(2,F+ba/2,T);y.push(txt);txt.node.setAttribute("textLength",L-4+"px");txt.node.firstChild.setAttribute("textLength",L-4+"px");w.push(e.path(Z))}});y.attr({"text-anchor":"start","font-family":"consolas"});w.attr({stroke:"#555"});u.attr({"stroke-width":.9,stroke:"#888",opacity:.6,"stroke-dasharray":". "})}function La(e,d,f,a,l,k,q,m,n){if(null!=d){f.attr("seqno");for(var v=0,u=a.length,y=0;y<d.length;y++)if("E"==d[y][2]||
"H"==d[y][2]){var w=null,z=null,t;for(t=d[y][0];t<=d[y][1];t++)if(!(a[v].getAttribute("s")>t)){for(s=v;s<u;s++)if(a[s].getAttribute("s")==t){v=s;w=g(a[s]);break}if(w)break}for(t=d[y][1];t>=d[y][0];t--){for(s=v;s<u;s++)if(a[s].getAttribute("s")==t){v=s;z=g(a[s]);break}if(z)break}if(null==w||null==z)v=0;else for(thisRow=w.closest("tr"),startRowIdx=f.index(thisRow),endRowIdx=f.index(z.closest("tr")),w=w.position(),startResLeft=w.left-k,spanTop=w.top,endResLeft=z.position().left-k,rightLimit=thisRow.width()-
m-m,z=startRowIdx;z<endRowIdx+1;z++)if(z>startRowIdx&&(thisRow=f.eq(z),spanTop=thisRow.find("span").first().position().top),t=thisRow.position().top+spanTop-l,"E"==d[y][2]){w=e;var A=startResLeft-(z-startRowIdx)*q,H=endResLeft+(endRowIdx-z)*q,I=m,F=n,C=rightLimit;t+=1;F-=2;padding=2;A=Math.max(-I,Math.round(A));H=Math.min(C,Math.round(H+I));s=w.path("M"+A+","+(t-padding)+"L"+(H-6)+","+(1.5+t)+"L"+(H-6)+","+(t-padding)+"L"+(H+padding)+","+(F/2+t)+"L"+(H-6)+","+(F+t+padding)+"L"+(H-6)+","+(F-1.5+t)+
"L"+A+","+(F+t+padding)+"L"+A+","+(t-padding));s.attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226","stroke-dasharray":"5 2"})}else w=e,A=startResLeft-(z-startRowIdx)*q,H=endResLeft+(endRowIdx-z)*q,I=m,F=n,C=rightLimit,padding=2,A=Math.max(-I,Math.round(A)),H=Math.min(C,Math.round(H+I)),h=w.rect(A,t+2-padding,H-A,F-4+2*padding,4),h.attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226"})}}}function Na(){var e="";"Multi FASTA"==g("#alignmentFormatSelect").val()?g(".alignTbl:visible").each(function(){e+=
ya(g(this).attr("id").substring(8),"FASTA");e+="\n"}):e=ya(g("#currentAlignmentIndex").val(),g("#alignmentFormatSelect").val());g("#formattedAlignmentTextarea").val(e);g("#formattedAlignmentTextarea").focus();g("#formattedAlignmentTextarea").select()}function ya(e,d){d||(d="fasta");var f=g("#alignNameTbl"+e),a=g("#alignTbl"+e),l=[],k=[],q=[],m=0<g("#alignTbl"+e+" :visible").first().length?":visible":"",n=0;f.find("tr[seqno]"+m).each(function(v,u){parseInt(u.getAttribute("seqno"))>n&&n++}).slice(0,
n).each(function(v){var u=g(this).attr("seqno");l[v]=g(this).text();q[v]=g(this).attr("title");breakCount=0;a.find('tr[seqno="'+u+'"]').each(function(y){k[v]||(k[v]="");k[v]+=g(this).find("td").first().text();breakCount+=g(this).find(".insert_l,.insert_r").length});0<breakCount&&(l[v]="MULTIPLE_SEGMENTS_OF_"+l[v]+" - WARNING - CONTAINS NON-SEQUENTIAL SEGMENTS")});return-1<d.search(/fasta/i)?cb(l,k,q):-1<d.search(/clustal/i)?db(l,k):""}function cb(e,d,f){if(!d||0==d.length)return"No templates selected";
for(var a="",l=0;l<e.length;l++){a+=">"+e[l]+(f&&f[l]?" "+f[l]:"")+"\n";for(var k=0;k<d[l].length;k+=72)a+=d[l].substring(k,k+72)+"\n"}return a}function db(e,d){if(!d||0==d.length)return"No templates selected";for(var f=0,a=0;a<e.length;a++)f=Math.max(f,e[a].length);f+=2;for(var l="CLUSTAL\n\n",k=0;k<d[0].length;k+=60){for(a=0;a<e.length;a++){l+=e[a];for(var q=e[a].length;q<f;q++)l+=" ";l+=d[a].substring(k,k+60)+"\n"}l+="\n"}return l=l.substring(0,l.length-2)}function eb(e){$alignNameTbl=N(e);var d=
e.closest(".alignTblContainer").outerWidth(),f=e.closest(".alignTblContainer").outerHeight();d+=10;var a='<svg xmlns="http://www.w3.org/2000/svg"  width="'+d+'" height="'+f+'"><rect x="0" y="0" fill="white" width="'+d+'" height="'+f+'"/>',l,k=$alignNameTbl.outerWidth()+10,q=$alignNameTbl.offset().left-10,m=e.find("td:eq(0)");d=m.outerWidth();var n=g("<div>").append(g("#"+e.attr("id")+"_features svg").first().clone()).html().replace(/name="[\d_]+" /g,"").replace(/r="4" /g,"");a+='<defs><clipPath id="cp2"><rect x="0" y="0" width="'+
d+'" height="'+f+'"/></clipPath></defs>';a+='<g transform="translate('+k+',0)" clip-path="url(#cp2)">';a+=n.substring(n.indexOf("</defs>")+7,n.indexOf("</svg>"));a+="</g>";f=e.find("tr:visible");f.each(function(y,w){g(this).find("span.ligandContact").each(function(z,t){l=w.offsetTop+t.offsetTop;v||(v=g(t).outerWidth(),u=g(t).outerHeight());g(t).css("color");a+='<rect style="fill:#CC4444;fill-opacity:0.8;" width="'+v+'" height="'+u+'" x="'+(g(t).offset().left-q)+'" y="'+l+'" />'})});a+='<text text-anchor="end" font-size="'+
m.css("font-size")+"\" font-family='"+m.css("font-family")+"'>";f=$alignNameTbl.find("tr:visible");f.each(function(y,w){var z=g(this).find("td").css("padding-top");z=parseInt(z.substring(0,z.length-2));l=w.offsetTop+12+z;a+='<tspan x="'+(k-2)+'" y="'+l+'">'+w.textContent.replace("QMEAN","")+"</tspan>"});a+="</text>";f=e.find("tr:visible");var v,u;f.offset();f.each(function(y,w){a+='<text text-anchor="middle" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'>";g(this).find("span").each(function(z,
t){v||(v=g(t).outerWidth(),u=g(t).outerHeight());if("relative"!=t.style.position){var A=g(t).css("color");A="fill:"+A+";";"bold"==t.style.fontWeight&&(A+="font-weight:bold;");0<A.length&&(A=' style="'+A+'" ');l=w.offsetTop+t.offsetTop+12;a+='<tspan x="'+(g(t).offset().left-q+v/2)+'" y="'+l+'"'+A+">"+t.textContent+"</tspan>"}});a+="</text>";(td=g(this).find("td")[1])&&(a+='<text text-anchor="start" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'><tspan x=\""+(g(td).offset().left-
q+10)+'" y="'+l+'">'+td.textContent+"</tspan></text>")});f.each(function(y,w){g(this).find("span").not(".ligandContact").each(function(z,t){l=w.offsetTop+t.offsetTop;var A=g(t).css("backgroundColor");A&&"transparent"!=A&&"rgb(255, 255, 255)"!=A&&(a+='<rect x="'+(g(t).offset().left-q)+'" y="'+l+'" width="'+v+'" height="'+u+'" style="fill:'+A+';"/>')})});return a+"</svg>"}var fa={gapChar:"-"},Oa=!1,ja=!1,S=null,ha=0,ba=0,sa=!1,Y=0,ia=0,V=[[136,221,204],[213,178,64],[187,187,221],[255,136,119],[136,
187,221],[255,187,102],[187,221,102],[255,204,238],[166,206,227],[187,136,187],[204,238,204],[166,206,227]],oa={init:function(e){Oa||(Oa=!0,g(document).keydown(function(d){if(ja&&1>g(".fancybox-desktop:visible").length)a:if(sa)d.preventDefault();else{var f=g("span.cursor").closest(".alignTbl");if(32==d.keyCode)d.preventDefault(),Aa();else if(8==d.keyCode||46==d.keyCode)d.preventDefault(),za(8==d.keyCode);else if(27==d.keyCode){f.data("startEditRegion",null);f.data("endEditRegion",null);g(".shadowCursor").removeClass("shadowCursor");
break a}else if((d.ctrlKey||d.metaKey)&&90==d.keyCode){d=g("body").data("editHistory");if(!(null==d||1>d.length)){d=d.pop();va(f,d,!0,!0);var a=g(".alignTbl").not(f);0<a.length&&(va(a,d,!0,!1),g(".cursor").removeClass("cursor"),f.find("tr[seqno="+S.seqno+"]").find("span").eq(S.seqidx).addClass("cursor"))}break a}wa(null,d)}else 27==d.keyCode&&(g(".hoverResidue").removeClass("hoverResidue"),g(".selectResidue").removeClass("selectResidue"))}));return this.each(function(){var d=g.extend({},{type:"target-template",
chaingroups:[],keyseq_sequence:e.keyseq_sequence,keyseq_chain_name:e.keyseq_chain_name?e.keyseq_chain_name:["A"],keyseq_annotation:e.keyseq_annotation},e.templateData);e.nowrap&&(d.nowrap=!0);if(e.charts&&e.keyseq_annotation){d.qmLength=0;d.charts=e.charts;for(key in e.keyseq_annotation)break;e.keyseq_annotation[key].qmean&&(d.pageResidueCount=e.pageResidueCount,ha=48);ba=12}e.resetColourCycle&&(Y=0);e.firstDraw=!0;g(this).data("templateData",d);da(g(this),null,e);oa.toggleIdenticalSeqs.call(this,
{chaingroups:d.chaingroups},!1);oa.resizeToParent.call(g(this),{redrawAnnotation:!1});la(g(this));W(g(this))})},toggleIdenticalSeqs:function(e,d){return g(this).each(function(){for(var f=g(this),a=N(f),l=0;l<e.chaingroups.length;l++){var k=e.chaingroups[l].filter(function(){return!0});if(!(2>k.length)){var q=k[0],m=a.find('tr[chain="'+q+'"]').first().text(),n=m.substring(0,m.lastIndexOf(".")+1)+"("+k.join("")+")";m=m.substring(0,m.lastIndexOf("."))+"."+q.charAt(0);for(var v="",u=1;u<k.length;u++)v+=
"[chain="+k[u]+"]",u<k.length-1&&(v+=",");f.find("tr"+v).toggle();a.find("tr"+v).toggle();"none"==a.find("tr[chain="+k[1]+"]").css("display")?a.find("tr[chain="+q+"]").find("td").html(n):a.find("tr[chain="+q+"]").find("td").html(m)}}("undefined"==typeof d||d)&&la(f)})},drawAlignment:function(e){return this.each(function(){da(g(this),e?e.seqs:null,e?e:null);W(g(this))})},getFormattedAlignment:function(e){return ya(g(this).attr("id").substring(8),e.format)},exportAlignment:function(e){return this.each(function(){g("#formattedAlignment").show();
g("#alignmentFormatSelect").val(e.format);Na();g("<a href='#formattedAlignment' title='Copy & Paste Alignment'/>'").fancybox({helpers:{title:{type:"inside"}}}).trigger("click");g("#formattedAlignmentTextarea").focus();g("#formattedAlignmentTextarea").select()})},html2image:function(e){g.fancybox.close();g(".popover").hide();e=g("#currentAlignmentIndex").val();$alTbl=g("#alignTbl"+e);e=eb($alTbl);e=new Blob([e],{type:"image/svg+xml;charset=utf-8"});e=(window.URL||window.webkitURL||window).createObjectURL(e);
var d=new Image,f=document.createElement("canvas"),a=f.getContext("2d");d.onload=function(){f.width=this.naturalWidth;f.height=this.naturalHeight;a.drawImage(this,0,0);f.toBlob(function(l){saveAs(l,"alignment.png")},"image/png")};d.src=e},colourAllAlignments:function(e){resetChainMappingColours();e.features?g(".alignTbl").each(function(){var d=[];g(this).find("tr[struc_id]").each(function(a,l){var k=l.getAttribute("struc_id");-1==d.indexOf(k)&&d.push(k)});var f={};for(struc_id in e.features)-1<d.indexOf(struc_id)&&
(f[struc_id]=e.features[struc_id]);0==Object.keys(f).length?g(this).removeData("features"):g(this).data("features",f);ka("features",g(this))}):(e.col||(e.col=chainMapping.defaultColourScheme),chainMapping.defaultColourScheme&&chainMapping.defaultColourScheme==e.col||jQuery.cookie("colourScheme",e.col,{expires:365,path:"/"}),g(".alignTbl").each(function(){g(this).removeData("features");ka(e.col,g(this))}));ra()},changeExportFormat:function(e){return this.each(function(){Na()})},secondaryStructure:function(e){e&&
jQuery.cookie("secStruct",e.sstype,{expires:365,path:"/"});var d=null;d=e?e.sstype:g.cookie("secStruct");null==d&&(d="dssp");ba="none"==d?0:12;e=this.each(function(){g(this).data("templateData")&&(la(g(this)),"secstruc"==g.cookie("colourScheme")&&ka("secstruc",g(this)))});var f=null,a=null;f=null;"undefined"!=typeof globalTemplateData?(g("#alignTbl"),"undefined"!=typeof globalTemplateData&&(a=globalTemplateData)):g(this).data("templateData")&&("model-template"==g(this).data("templateData").type?f=
!0:(a=[],this.each(function(){g(this).data("templateData")&&(a=a.concat(g(this).data("templateData").templates))})));if(0<g("#pv:visible",currentWin.document).length)if(f)this.each(function(){var u=g(this).data("templateData");if(u){var y=u.struc_id;if(pv_viewer.get(y)){var w=pv_viewer.get(y).structure();pv_viewer.rm(y);var z="none"==d;if(!z)for(var t=0;t<u.keyseq_chain_name.length;t++){var A=u.keyseq_chain_name[t],H=u.templates[0].trg_offset;H||(H=1);var I=u.keyseq_annotation[A][d+"_string"];A=w.select({chain:A});
I?A.eachResidue(function(F){F.full().setSS(I[F.num()-H])}):z=!0}z&&w.select("protein").eachResidue(function(F){F.full().setSS("")});pv_viewer.cartoon(y,w,{color:pv.color.uniform("white")})}}});else for(var l=0;l<a.length;l++){if(a[l].selected){var k=a[l].struc_id;f=pv_viewer.get(k).structure();pv_viewer.rm(k);if("none"==d)f.select("protein").eachResidue(function(u){u.full().setSS("")});else if(a[l].targets)for(var q=0;q<a[l].targets.length;q++)for(var m=a[l].targets[q],n=0;n<m.chain.length;n++)(v=
m.annotation[m.chain[n]][d+"_string"])||(v=m.annotation[m.chain[n]][d]),f.select({chain:m.chain[n]}).eachResidue(function(u){u.full().setSS(v[u.num()-1])});else{var v=a[l].annotation[d+"_string"];v||(v=a[l].annotation[d]);f.select({chain:a[l].chain}).eachResidue(function(u){u.full().setSS(v?v[u.num()-1]:"")})}pv_viewer.cartoon(k,f,{color:pv.color.uniform("white")})}}else if(0<g("#ngl:visible",currentWin.document).length)if(f)this.each(function(){var u=g(this).data("templateData");if(u)for(var y=u.struc_id,
w="none"==d,z=0;z<u.keyseq_chain_name.length;z++){var t=u.keyseq_chain_name[z],A=u.templates[0].trg_offset;A||(A=1);var H=u.keyseq_annotation[t][d+"_string"];H||(w=!0);for(comp in ngl_stage.compList)if(ngl_stage.compList[comp].name==y){ngl_stage.compList[comp].structure.eachResidue(function(I){I.chainname==t&&(I.sstruc=w?"":H[I.resno-A].toLowerCase())});break}}});else for(l=0;l<a.length;l++)if(a[l].selected){ngl_stage.eachRepresentation(function(u){if(u.name&&!u.name.match(/(ligands|dna|over)/)){var y=
u.name;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==y&&ngl_stage.compList[comp].removeRepresentation(u)}});if("none"==d)for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==a[l].struc_id&&ngl_stage.compList[comp].structure.eachResidue(function(u){u.sstruc=""});else if(a[l].targets)for(q=0;q<a[l].targets.length;q++)for(m=a[l].targets[q],n=0;n<m.chain.length;n++)for(comp in(v=m.annotation[m.chain[n]][d+"_string"])||(v=m.annotation[m.chain[n]][d]),ngl_stage.compList){if(ngl_stage.compList[comp].name==
a[l].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(u){u.chainname==m.chain[n]&&(u.sstruc=v[u.resno-1].toLowerCase())});break}}else for(comp in v=a[l].annotation[d+"_string"]?a[l].annotation[d+"_string"]:a[l].annotation[d],ngl_stage.compList)if(ngl_stage.compList[comp].name==a[l].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(u){u.chainname==a[l].chain&&(u.sstruc=v?v[u.resno-1].toLowerCase():"")});break}k=a[l].struc_id;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==
k&&ngl_stage.compList[comp].addRepresentation("cartoon",{name:k,sele:"not :_ and not nucleic and not :-",smoothSheet:!0,aspectRatio:6,roughness:1})}changeRep(g.cookie("defaultRepr"));ra();return e},targetMismatch:function(e){e.match?jQuery.cookie("targetMismatch",e.match,{expires:365,path:"/"}):jQuery.removeCookie("targetMismatch",{path:"/"});return this.each(function(){g(this).find("span.targetMismatch").removeClass("targetMismatch");if("fade"==e.match)g("#enhanceMismatch_cb").prop("checked",!1),
g(this).find("span[nm]").addClass("targetMismatch");else if("enhance"==e.match){g("#fadeMismatch_cb").prop("checked",!1);var d=g(this).find("span");d.not("[nm]").addClass("targetMismatch");d.not("[s]").addClass("targetMismatch")}})},viewerInitialised:function(e){var d=chainMapping.defaultColourScheme?chainMapping.defaultColourScheme:g.cookie("colourScheme");-1<["qmean_local","confClass","bfactor","bfactor_range","secstruc"].indexOf(d)?g(".alignTbl:first").alignment("colourAllAlignments",{col:d}):
ra(e);0<g("#pv:visible",currentWin.document).length&&pv_viewer.fitParent()},updateColoursSingleResidue:function(e){ra({singleResidue:e})},resizeToParent:function(e,d){d=e?e.redrawAnnotation:!0;return this.each(function(){var f=g(this);if(f.is(":visible")&&f.data("templateData")){var a=g(this).find("tr:visible td").first(),l=a.find("span").first()[0];if(l){var k=f.width()-a.width(),q=f.parent().closest("table").parent();q=q.width()-(f.offset().left-q.offset().left)-k;f.data("templateData").nowrap&&
(q=1E7);k=a.text().length;l=Math.floor(q/l.getBoundingClientRect().width);f.data("options").textOnly&&(l=Math.floor(q/(a.width()/a.text().length)));l-=l%5;1>l&&(l=5);a=0<f.find("tr:hidden").length;q=f.data("templateData").chaingroups;l!=k?(f.attr("cols_cookie")&&g.cookie(f.attr("cols_cookie"),l,{expires:365,path:"/"}),da(f,null,{cols:l}),d&&la(f),a&&oa.toggleIdenticalSeqs.call(f,{chaingroups:q})):(d&&la(f),g("#"+f.attr("id")+"_features").css("top",f.position().top))}}})},toggleEditMode:function(e){g(this).attr("id").substring("8");
(ja=e&&null!=e.edit?e.edit:!ja)?(g("a[id^=gapEdit_]").css("opacity",1),g(".hoverResidue").removeClass("hoverResidue"),null==S&&(S={seqno:1,seqidx:0}),g(this).find("tr[seqno="+S.seqno+"]").find("span").eq(S.seqidx).addClass("cursor")):(g("a[id^=gapEdit_]").css("opacity",.6),g(".cursor").removeClass("cursor"))},removeGappedColumns:function(e){e=g(this).data("templateData").templates;var d=e[0].trg_seq;for(var f=e[0].tpl_seq,a="",l="",k=0;k<d.length;k++)if("-"!=d.charAt(k)||"-"!=f.charAt(k))a+=d.charAt(k),
l+=f.charAt(k);d=[a,l];e[0].trg_seq=d[0];e[0].tpl_seq=d[1];da(g(this))}},Ea={},Wa=[238,51,17],Ka=[17,119,238],ua=[17,204,17],Ua=[255,102,0],Xa=[17,187,187],Va=[238,119,119],Ja=[204,68,204],Ta=[204,204,0],aa={A:{name:"Alanine",triplet:"ALA",hydrophobic:.7,size:.11},C:{name:"Cysteine",triplet:"CYS",hydrophobic:.78,size:.35},D:{name:"Aspartate",triplet:"ASP",hydrophobic:.11,size:.45},E:{name:"Glutamate",triplet:"GLU",hydrophobic:.11,size:.56},F:{name:"Phenylalanine",triplet:"PHE",hydrophobic:.81,size:.7},
G:{name:"Glycine",triplet:"GLY",hydrophobic:.46,size:0},H:{name:"Histidine",triplet:"HIS",hydrophobic:.14,size:.62},I:{name:"Isoleucine",triplet:"ILE",hydrophobic:1,size:.43},K:{name:"Lysine",triplet:"LYS",hydrophobic:.07,size:.55},L:{name:"Leucine",triplet:"LEU",hydrophobic:.92,size:.43},M:{name:"Methionine",triplet:"MET",hydrophobic:.71,size:.57},N:{name:"Asparagine",triplet:"ASN",hydrophobic:.11,size:.44},P:{name:"Proline",triplet:"PRO",hydrophobic:.32,size:.31},Q:{name:"Glutamine",triplet:"GLN",
hydrophobic:.11,size:.55},R:{name:"Arginine",triplet:"ARG",hydrophobic:0,size:.77},S:{name:"Serine",triplet:"SER",hydrophobic:.41,size:.23},T:{name:"Threonine",triplet:"THR",hydrophobic:.42,size:.34},V:{name:"Valine",triplet:"VAL",hydrophobic:.97,size:.32},W:{name:"Tryptophan",triplet:"TRP",hydrophobic:.4,size:1},Y:{name:"Tyrosine",triplet:"TYR",hydrophobic:.36,size:.82},B:{name:"Aspartate or Asparagine",triplet:"ASX"},Z:{name:"Glutamate or Glutamine",triplet:"GLX"},J:{name:"Leucine or Isoleucine",
triplet:"XLE"},X:{name:"Unknown",triplet:"UNC"},"?":{name:"Unknown",triplet:"UNC"},hydrophobic:"LIFWVM",polar:"RKDENQ",small:"TDN",large:"WYRFH",aliphatic:"ILV",charged:"HKRED",positive:"HKR",negative:"ED",tiny:"AGS",aromatic:"FYWH",proline:"P",serThr:"ST"};g.fn.alignment=function(e){if(oa[e])return oa[e].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof e&&e)g.error("Method "+e+" does not exist on alignment.min.js");else return oa.init.apply(this,arguments)}})(jQuery);
Object.keys||(Object.keys=function(g){var N=[],W;for(W in g)g.hasOwnProperty(W)&&N.push(W);return N});$(document).on("click",".alignmentOptions input[name=csRadioGroup]",function(){delete chainMapping.defaultColourScheme;$(".alignTbl:first").alignment("colourAllAlignments",{col:$(this).val()})});$(document).on("click","#viewerSelect input[name=3dRG]",function(){showViewer($(this).val())});
$("body").on("highlightResidue",function(g,N){if("alignment"!=N.src){N.multiple||$(".hoverResidue").removeClass("hoverResidue");var W=$('.alignTbl tr[struc_id^="'+N.struc_id+'"]:visible');0==W.length&&(W=$('.alignTbl tr[tpl_id="'+N.struc_id+'"]:visible'));if(0<W.length){var ca=W.filter('[chain="'+N.chain+'"]');0==ca.length&&(ca=W.filter('[keyseqchain="'+N.chain+'"]'));0<ca.length&&ca.find("span[s="+N.resno+"]").addClass("hoverResidue")}}});
$("body").on("click",function(g){$(".poponthis").each(function(){$(this).is(g.target)||0!==$(this).has(g.target).length||0!==$(".popover").has(g.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})});
function addSettingsPopover(){$("a[id^=options_]").css("visibility","visible").each(function(){$(this).popover({html:!0,placement:$(this).attr("pop-placement")?$(this).attr("pop-placement"):"auto",content:$("#alignmentOptions"),container:1==$(this).closest("#viewerWrapper").length?"#right-panel":"body"})}).on("show.bs.popover",function(g){var N=$(this).attr("id").substring(8);$(this).data("bs.popover").$tip.find("#exportOptions");$("#currentAlignmentIndex").val(N);1==$("#exportOptions").length?($("#alignmentOptions").show(),
""==N?$("#exportOptions").hide():$("#exportOptions").show()):$("a[id^=options_]").each(function(){$(this).data("bs.popover")&&$(this).data("bs.popover").$tip&&1==$(this).data("bs.popover").$tip.find("#exportOptions").length&&(""==N?$(this).data("bs.popover").$tip.find("#exportOptions").hide():$(this).data("bs.popover").$tip.find("#exportOptions").show())})})}addSettingsPopover();
0<$("#bgColSlider").length&&$("#bgColSlider").slider({value:$.cookie("bg_r")?$.cookie("bg_r"):255,min:0,max:255,step:1,slide:function(g,N){pv_viewer.options("background",[N.value/255,N.value/255,N.value/255]);ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+N.value+","+N.value+","+N.value+")"});jQuery.cookie("bg_r",N.value,{expires:365,path:"/"})},change:function(g,N){pv_viewer.options("background",[N.value/255,N.value/255,N.value/255]);ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+
N.value+","+N.value+","+N.value+")"});jQuery.cookie("bg_r",N.value,{expires:365,path:"/"});180>N.value?$(".viewerStatus").addClass("status_dark"):$(".viewerStatus").removeClass("status_dark")}});$.cookie("bg_r")&&180>$.cookie("bg_r")&&$(".viewerStatus").addClass("status_dark");function resetChainMappingColours(){for(s in chainMapping.structures)for(c in chainMapping.structures[s])for(r in chainMapping.structures[s][c])delete chainMapping.structures[s][c][r].rgb}
var chainMapping={structures:{},targets:{},alignments:[],chainMeta:{},annotations:[{key:"qm",label:"Confidence",active:!0},{key:"qmb",label:"QMEANBrane",active:!1},{key:"c",label:"Consistency",active:!0},{key:"entropy",label:"Entropy",active:!0},{key:"soa",label:"Solvent Accessibility",active:!0},{key:"bfactor",label:"B-factor",active:!0},{key:"bfactor_range",label:"B-factor range",active:!0}]};