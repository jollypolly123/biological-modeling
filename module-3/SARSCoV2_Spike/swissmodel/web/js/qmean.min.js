function qmeanLocalColour(a,z){return.4<a?null==z?"rgb("+Math.round(1/.6*(1-a)*255)+",80,"+Math.round(1/.6*(a-.4)*255)+")":"rgba("+Math.round(1/.6*(1-a)*255)+",80,"+Math.round(1/.6*(a-.4)*255)+","+z+")":null==z?"rgb(255,80,0)":"rgba(255,80,0,"+z+")"}
function drawQMEANLocal(a,z,m,E,k,F){var A=F?"qmb":"qm",g=["lq-chart"+(m?"-"+m:"")];if(k||!(0<$("#"+g[0]+" svg").length)){a=chainMapping.structures[a];for(k=0;k<Object.keys(a).length;k++){var e="lq-chart"+(m?"-"+m:"");0==k&&(0==$("#"+e).length?$("body").append("<div"+(m?' rel="'+m+'"':"")+' id="'+e+'" style="display:none"></div>'):$("#"+e).empty(),$("#"+e+"-thumb").empty());if(1==Object.keys(a).length)break;e+="-"+Object.keys(a)[k];g.push(e);0==$("#"+e).length?$("body").append("<div"+(m?' rel="'+
m+'"':"")+' id="'+e+'" style="display:none"></div>'):$("#"+e).empty();0==$('a[href="#'+e+'"]').length&&$("body").append('<a href="#'+e+'" rel="lq-'+(m?m:"")+'" class="fancybox"/>')}k=!0;for(e=0;e<g.length;e++){var p=0,r=0,u=0,v=!1;if(k){$("#"+g[e]+"-thumb").attr("title","Click to enlarge");var w=$("#"+g[e]+"-thumb").closest(":visible").width();var h=$("#"+g[e]+"-thumb").closest(":visible").height();if(null==w||null==h)break;0==h&&(h=Math.min(200,.5*w));if(200<=h){var t=12;p=45;r=30;u=40;v=!0}else E&&
(p=30,r=16),t=Math.max(15,h/10)}else t=20,p=45,r=30,u=40,w=.7*$(window).width()+p,h=.7*$(window).height()+u+r;for(var x=Raphael(g[e]+(k?"-thumb":""),w,h),D=99999,d=0,n=0,B=0,c=999,q=0,f=Object.keys(a),b=0;b<f.length;b++)if(!(0<e&&e-1!=b))for(var l=0;l<a[f[b]].length;l++)a[f[b]][l]&&a[f[b]][l][A]&&(c=Math.min(c,a[f[b]][l][A]),q=Math.max(q,a[f[b]][l][A]),D=Math.min(a[f[b]][l].resno,D),d=Math.max(a[f[b]][l].resno,d),B+=1,n+=a[f[b]][l][A]);q=1>=q;l=1;q?c=Math.min(.3,c):(l=100,c=Math.min(70,c));null==
z&&(z=n/B);$("#avgLocalQMEAN,#avgLocalScore_"+m).html(z.toFixed(2));n=h-u-r;B=(w-p)/(d-D);x.rect(0,0,w,h).attr({fill:"#FFF",stroke:"#FFF"});if(k&&!v)x.rect(p,r,w-p,n).attr({stroke:"#DDD"}),E&&(x.text(w/2,8,"Local Quality Estimate").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,h/24)}),x.text(6,h/2+r/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,h/26)}).rotate(270,6,h/2+r/2),x.text(18,h/2+r/2,"Similarity to Target").attr({"text-anchor":"middle",
fill:"#666","font-size":Math.max(8,h/26)}).rotate(270,18,h/2+r/2));else{x.rect(p,r,w-p,n).attr({stroke:"#DDD"});v=14;b="Local Quality Estimate";F&&(b+=" (QMEANBrane) ");b=0==e?1==f.length?b+(" - Chain "+f[0]):b+" - All Chains":b+(" - Chain "+f[e-1]);x.text(w/2,10,b).attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,h/26)});k?(x.text(6,h/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":t}).rotate(270,6,h/2),x.text(18,h/2,"Similarity to Target").attr({"text-anchor":"middle",
fill:"#666","font-size":t}).rotate(270,18,h/2),v=t):x.text(10,h/2,"Predicted Local Similarity to Target").attr({dy:10,"text-anchor":"middle",fill:"#666","font-size":t}).rotate(270,10,h/2);x.text(p+(w-p)/2,h-8,"Residue Number").attr({"text-anchor":"middle",fill:"#666","font-size":t});for(b=l;b>=c;b-=q?.1:10)x.path("M"+p+" "+(n/(l-c)*(l-b)+r)+"L"+(p-5)+" "+(n/(l-c)*(l-b)+r)).attr({stroke:"#CCC","stroke-width":1}),x.text(p-12,n/(l-c)*(l-b)+r,b.toFixed(q?1:0)).attr({fill:"#444","font-size":v});t=Math.floor((d-
D)/8);t-=t%10;t=Math.max(10,t);var y=null;for(b=D;b<d;b++)if(0==b%t){var C=p+(b-D)/(d-D)*(w-p);y&&y>C||(y=x.text(C,h-u+12,b).attr({fill:"#444","font-size":v}),y=C+y.getBBox().width)}}w="#999999 #E69F00 #56B4E9 #009E73 #F0E442 #0072B2 #D55E00 #CC79A7".split(" ");for(u=h=0;u<f.length;u++){d=null;if(0==e||e-1==u){b=n/(l-Math.min(c,z))*(l-z)+r;for(t=0;t<a[f[u]].length;t++)a[f[u]][t]&&(v=a[f[u]][t][A],null!=v&&(C=p+B*(a[f[u]][t].resno-D),y=b-n/(l-c)*(v-z),0==e&&1<f.length?(y=Math.min(y,n+r),d=null==d?
"M"+C+" "+y:d+("L"+C+" "+y),d+="L"+(C+B)+" "+y):(v>z?bar=x.rect(C,y,B,n/(l-c)*(v-z)):(y=n/(l-c)*(z-v),y=Math.min(y,n-b+r),bar=x.rect(C,b,B,y)),v=qmeanLocalColour(q?v:v/100),bar.attr({stroke:v,"stroke-width":.7,fill:v,"fill-opacity":.4}))));0==e&&1<f.length&&(d=x.path(d),d.attr({stroke:w[h],"stroke-width":k?1:1.5}),k||$("#lq-chart"+(m?"-"+m:"")).append((0==u?"<br>Key: ":"")+' <span style="margin-right:4px; color:'+w[h]+'">Chain '+f[u]+";</span>"))}h=++h%w.length}k&&(k=!1,e--)}}}
function drawQMEANGlobal(a,z,m,E,k){var F=$("#qn-chart"+(m?"-"+m:"")+"-thumb,#qn-chart"+(m?"-"+m:""));if(a&&(m="qmeanGlobalTbl"+(m?m:""),k||!(0<$("#"+m+" tr").length))){F.empty();$("#"+m+" tr").remove();a.QMEAN4&&(a.qmean4_norm_score=a.qmean4_norm,delete a.qmean4_norm,a.qmean4_z_score=a.QMEAN4,delete a.QMEAN4,a.cbeta_z_score=a.cbeta,delete a.cbeta,a.interaction_z_score=a.all_atom,delete a.all_atom,a.packing_z_score=a.solvation,delete a.solvation,a.torsion_z_score=a.torsion,delete a.torsion);a.qmean4&&
(a.qmean4_norm_score=parseFloat(a.qmean4.norm),a.qmean4_z_score=parseFloat(a.qmean4.zscore),delete a.qmean4,a.cbeta_z_score=parseFloat(a.cbeta.zscore),delete a.cbeta,a.interaction_z_score=parseFloat(a.all_atom.zscore),delete a.all_atom,a.packing_z_score=parseFloat(a.solvation.zscore),delete a.solvation,a.torsion_z_score=parseFloat(a.torsion.zscore),delete a.torsion,delete a.acc_agreement,delete a.ss_agreement,delete a.qmean6);k=[["qmean4_z_score","QMEAN"],["cbeta_z_score","C\u03b2"],["interaction_z_score",
"All Atom"],["packing_z_score","solvation"],["torsion_z_score","torsion"]];for(var A="",g=0;g<k.length;g++)null!=a[k[g][0]]&&(A+='<tr><td width="1">'+k[g][1]+'</td><td width="100%" style="padding:0px 2px 0px 2px;"><div id="'+m+"_"+k[g][0]+'">&nbsp;</div></td><td width="1" nowrap="nowrap" style="text-align:right">'+a[k[g][0]].toFixed(2)+"</td></tr>");$("#"+m).append(A);A=$("#"+m+"_"+k[0][0]).innerWidth();var e=$("#"+m+"_"+k[0][0]).parent().innerHeight();if(1>A||1>e)A=290,e=20;for(g=0;g<k.length;g++)$("#"+
m+"_"+k[g][0]).html("");for(var p=A/8,r=0;r<k.length;r++)if(null!=a[k[r][0]]){var u=Raphael(m+"_"+k[r][0],A,e);u.rect(0,0,A,e).attr({fill:"0-rgb(245,61,61)-#fff:75-rgb(77,77,255)"});var v=e/4;for(g=1;8>g;g++)u.path("M"+p*g+" 0L"+p*g+" "+v).attr({stroke:"#555"}),u.path("M"+p*g+" "+(e-v)+"L"+p*g+" "+e).attr({stroke:"#555"});a&&(g=a[k[r][0]],g=Math.min(g,1.95),g=Math.max(g,-5.95),u.path("M"+(p*g+6*p)+" 0L"+(p*g+6*p)+" "+e).attr({stroke:"#222","stroke-width":3}))}var w=a.qmean4_norm_score,h=Math.min(600,
z),t=!0;F.each(function(x,D){var d=0,n=0,B=0;if(t){$(this).attr("title","Click to enlarge");var c=$(this).closest(":visible").width();if(340<c){var q=12;d=45;n=30;B=40;c-=d;var f=400/620*c-B+n}else f=.5*c,E&&(d=15,n=30),q=Math.max(15,f/10)}else q=20,d=45,n=30,B=40,c=617+d,f=398+B+n;var b=Raphael($(this).attr("id"),c,f),l=f-B-n,y=h/600*(c-d)+d,C=l-w/1.5*l+n;b.rect(0,0,c,f).attr({fill:"#FFF",stroke:"#FFF"});"undefined"===typeof localQMEANNormImage?b.image("/static/images/qmean_norm.png",d,n,c-d,l):
b.image(localQMEANNormImage,d,n,c-d,l);b.rect(d,n,c-d,l).attr({stroke:"#DDD"});b.text(y,C,String.fromCharCode(9733)).attr({"text-anchor":"middle",fill:"#F44","font-size":q});if(t)E&&(b.text((c+d)/2,8,"Comparison with Non-redundant").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,c/32)}),b.text((c+d)/2,22,"Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,c/32)}),b.text(6,f/2+n/2,"Normalized QMEAN4").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,
c/32)}).rotate(270,6,f/2+n/2)),b.rect(d+1,f-Math.max(16,c/16),c-d-2,Math.max(16,c/16)).attr({fill:"#FFF","stroke-width":0}),b.text(c/2,f-8,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,c/32)});else{b.text((c+d)/2,10,"Comparison with Non-redundant Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":q});b.text(10,f/2,"Normalized QMEAN4 Score").attr({"text-anchor":"middle",fill:"#666","font-size":q}).rotate(270,10,f/2);b.text(d+(c-
d)/2,f-12,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#666","font-size":q});for(q=100;600>q;q+=100)b.text(d+q*(c-d)/600,f-B+8,q).attr({fill:"#444","font-size":14});for(q=1.5;0<=q;q-=.5)b.text(d-12,q/1.5*l+n,(1.5-q).toFixed(1)).attr({fill:"#444","font-size":14})}t=!1})}};